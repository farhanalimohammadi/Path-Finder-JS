{"remainingRequest":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/src/components/VisualizerCanvas.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/src/components/VisualizerCanvas.vue","mtime":1771256159756},{"path":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/node_modules/cache-loader/dist/cjs.js","mtime":1771499059513},{"path":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/node_modules/babel-loader/lib/index.js","mtime":1771499059998},{"path":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/node_modules/cache-loader/dist/cjs.js","mtime":1771499059513},{"path":"/home/farhan/Desktop/My-Projects/city-project/Pathfinding-Visualizer-ThreeJS/node_modules/vue-loader/lib/index.js","mtime":1771499060190}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCAqIGFzIFRIUkVFIGZyb20gInRocmVlIjsKaW1wb3J0IHsgT3JiaXRDb250cm9scyB9IGZyb20gInRocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9PcmJpdENvbnRyb2xzLmpzIjsKaW1wb3J0IHsgUG9pbnRlckxvY2tDb250cm9scyB9IGZyb20gInRocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9Qb2ludGVyTG9ja0NvbnRyb2xzLmpzIjsKaW1wb3J0IFRXRUVOLCB7IHJlbW92ZUFsbCB9IGZyb20gIkB0d2VlbmpzL3R3ZWVuLmpzIjsKaW1wb3J0IFN0YXRzIGZyb20gInRocmVlL2V4YW1wbGVzL2pzbS9saWJzL3N0YXRzLm1vZHVsZS5qcyI7CgppbXBvcnQgeyBnZXRBbGxOb2RlcywgdHdlZW5Ub0NvbG9yIH0gZnJvbSAiLi9hbGdvcml0aG1zL2hlbHBlcnMuanMiOwoKZXhwb3J0IGRlZmF1bHQgewoJcHJvcHM6IFsKCQkibm9kZURpbWVuc2lvbnMiLAoJCSJncmlkIiwKCQkicm93cyIsCgkJImNvbHMiLAoJCSJzdGFydCIsCgkJImZpbmlzaCIsCgkJInZpc3VhbGl6ZXJTdGF0ZSIsCgkJImNvbG9ycyIsCgkJImNvbnRyb2xUeXBlIiwKCQkid29ybGRTZXR1cCIsCgkJInNlbGVjdGVkQWxnb3JpdGhtIiwKCQkic3RyZWFtaW5nIiwKCQkidGhyZXNob2xkVmFsdWUiCgldLAoJZGF0YTogKCkgPT4gKHsKCQlzY2VuZTogbnVsbCwKCQljYW1lcmE6IG51bGwsCgkJY2FtZXJhWTogMCwKCQlkZWZhdWx0Q2FtZXJhWTogMjUwLAoJCXJlbmRlcmVyOiBudWxsLAoJCXBvaW50ZXJMb2NrOiB7CgkJCW1vdmVGb3J3YXJkOiBmYWxzZSwKCQkJbW92ZUJhY2t3YXJkOiBmYWxzZSwKCQkJbW92ZUxlZnQ6IGZhbHNlLAoJCQltb3ZlUmlnaHQ6IGZhbHNlLAoJCQl2ZWxvY2l0eTogbnVsbCwKCQkJZGlyZWN0aW9uOiBudWxsLAoJCQlwcmV2VGltZTogbnVsbCwKCQl9LAoJCWNvbnRyb2xzOiBudWxsLAoJCW9yYml0Q29udHJvbHM6IG51bGwsCgkJcG9pbnRlckxvY2tDb250cm9sczogbnVsbCwKCQlyYXljYXN0ZXI6IG51bGwsCgkJYW1iaWVudExpZ2h0OiBudWxsLAoJCWhlbWlzcGhlcmVMaWdodDogbnVsbCwKCQlkaXJlY3Rpb25hbExpZ2h0OiBudWxsLAoJCWdyb3VuZDogbnVsbCwKCQl3YWxsR2VvbXRlcnk6IG51bGwsCgkJd2FsbE1hdGVyaWFsczogW10sCgkJd2FsbHM6IHt9LAoJCXdhbGxUZXh0dXJlczogWwoJCQl7CgkJCQlwYXRoOiAiYnVpbGRpbmcxLnBuZyIsCgkJCQlyZXBlYXRZOiAxLAoJCQl9LAoJCQl7CgkJCQlwYXRoOiAiYnVpbGRpbmcyLnBuZyIsCgkJCQlyZXBlYXRZOiAyLAoJCQl9LAoJCQl7CgkJCQlwYXRoOiAiYnVpbGRpbmczLnBuZyIsCgkJCQlyZXBlYXRZOiAzLAoJCQl9LAoJCV0sCgkJZG93bjogZmFsc2UsCgkJbW92ZWQ6IGZhbHNlLAoJCWN1cnJlbnRFdmVudDogbnVsbCwKCQltb3VzZTogbnVsbCwKCQlpbnRlcnNlY3RlZE5vZGU6IG51bGwsCgkJY2xvY2s6IG51bGwsCgkJc3RhdHM6IG51bGwsCgkJLy8gRGV2aWNlIGNhbQoJCXZpZGVvQ2FudmFzOiBudWxsLAoJCXZpZGVvOiBudWxsCgl9KSwKCWNvbXB1dGVkOiB7CgkJY2xpY2thYmxlT2JqZWN0cygpIHsKCQkJbGV0IG9iamVjdHMgPSBbXTsKCQkJb2JqZWN0cy5wdXNoKHRoaXMuZ3JvdW5kKTsKCQkJZm9yIChsZXQgaWQgb2YgT2JqZWN0LmtleXModGhpcy53YWxscykpIHsKCQkJCWlmICh0aGlzLndhbGxzW2lkXS52aXNpYmxlKSB7CgkJCQkJb2JqZWN0cy5wdXNoKHRoaXMud2FsbHNbaWRdKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gb2JqZWN0czsKCQl9LAoJCWNvbGxpZGFibGVPYmplY3RzKCkgewoJCQlsZXQgb2JqZWN0cyA9IFtdOwoJCQlmb3IgKGxldCBpZCBvZiBPYmplY3Qua2V5cyh0aGlzLndhbGxzKSkgewoJCQkJaWYgKHRoaXMud2FsbHNbaWRdLnZpc2libGUpIHsKCQkJCQlvYmplY3RzLnB1c2godGhpcy53YWxsc1tpZF0pOwoJCQkJfQoJCQl9CgkJCXJldHVybiBvYmplY3RzOwoJCX0KCX0sCgl3YXRjaDogewoJCWNvbnRyb2xUeXBlOiBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkgewoJCQl0aGlzLnNldENvbnRyb2xzKCk7CgkJfSwKCQl3b3JsZFNldHVwOiBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkgewoJCQlpZiAobmV3VmFsKSB7CgkJCQlUV0VFTi5yZW1vdmVBbGwoKTsKCQkJCW5ldyBUV0VFTi5Ud2Vlbih0aGlzLmNhbWVyYS5wb3NpdGlvbikKCQkJCQkudG8oeyB4OiAwLCB5OiB0aGlzLmNhbWVyYVkgLSAzMCwgejogMCB9LCA1MDApCgkJCQkJLmVhc2luZyhUV0VFTi5FYXNpbmcuRXhwb25lbnRpYWwuT3V0KQoJCQkJCS5vblVwZGF0ZSgoKSA9PiB7CgkJCQkJCXRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLnNjZW5lLnBvc2l0aW9uKTsKCQkJCQl9KQoJCQkJCS5vbkNvbXBsZXRlKCgpID0+IHsKCQkJCQkJdGhpcy5jb250cm9scy5lbmFibGVSb3RhdGUgPSBmYWxzZTsKCQkJCQkJbGV0IGxvb2tEaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoJCQkJCQl0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihsb29rRGlyZWN0aW9uKTsKCQkJCQkJdGhpcy5jb250cm9scy50YXJnZXQKCQkJCQkJCS5jb3B5KHRoaXMuY2FtZXJhLnBvc2l0aW9uKQoJCQkJCQkJLmFkZChsb29rRGlyZWN0aW9uLm11bHRpcGx5U2NhbGFyKHRoaXMuY2FtZXJhWSAtIDMwKSk7CgkJCQkJfSkKCQkJCQkuc3RhcnQoKTsKCQkJCW5ldyBUV0VFTi5Ud2Vlbih0aGlzLmNhbWVyYS5yb3RhdGlvbikKCQkJCQkudG8oeyB5OiAwLCB6OiAwIH0sIDUwMCkKCQkJCQkuZWFzaW5nKFRXRUVOLkVhc2luZy5FeHBvbmVudGlhbC5PdXQpCgkJCQkJLnN0YXJ0KCk7CgkJCX0gZWxzZSB7CgkJCQluZXcgVFdFRU4uVHdlZW4odGhpcy5jYW1lcmEucG9zaXRpb24pCgkJCQkJLnRvKHsgeTogdGhpcy5jYW1lcmFZIH0sIDUwMCkKCQkJCQkuZWFzaW5nKFRXRUVOLkVhc2luZy5FeHBvbmVudGlhbC5PdXQpCgkJCQkJLm9uQ29tcGxldGUoKCkgPT4gewoJCQkJCQl0aGlzLmNvbnRyb2xzLmVuYWJsZVJvdGF0ZSA9IHRydWU7CgkJCQkJCXRoaXMuY29udHJvbHMudXBkYXRlKCk7CgkJCQkJfSkKCQkJCQkuc3RhcnQoKTsKCQkJfQoJCX0sCgkJc3RyZWFtaW5nOiBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkgewoJCQlpZighbmV3VmFsKSB7CgkJCQlmb3IobGV0IGk9MDsgaTx0aGlzLnJvd3M7IGkrKykgewoJCQkJCWZvcihsZXQgaj0wOyBqPHRoaXMuY29sczsgaisrKSB7CgkJCQkJCXRoaXMudXBkYXRlTm9kZSh0aGlzLmdyaWRbaV1bal0pOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0sCgljcmVhdGVkKCkgewoJCXRoaXMuY2FtZXJhWSA9IHRoaXMuZGVmYXVsdENhbWVyYVk7Cgl9LAoJbW91bnRlZCgpIHsKCQl0aGlzLmluaXQoKTsKCQkKCQl0aGlzLnZpZGVvQ2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ZpZGVvLWNhbnZhcycpOwoJCXRoaXMudmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd2aWRlbycpOwoJfSwKCW1ldGhvZHM6IHsKCQlpbml0KCkgewoJCQlsZXQgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCwKCQkJCWhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKCgkJCS8vU2NlbmUKCQkJdGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwoJCQl0aGlzLnNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHhiYmQ2ZmYpOwoJCQl0aGlzLnNjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2coMHhmZmZmZmYsIDAsIDc1MCk7CgoJCQkvL0NhbWVyYQoJCQl0aGlzLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSg2MCwgd2lkdGggLyBoZWlnaHQsIDEsIDUwMDApOwoJCQl0aGlzLmNhbWVyYS5wb3NpdGlvbi55ID0gdGhpcy5jYW1lcmFZICsgMjAwMDsKCQkJdGhpcy5jYW1lcmEucG9zaXRpb24ueCA9IC01MDA7CgkJCXRoaXMuY2FtZXJhLnBvc2l0aW9uLnogPSA1MDA7CgkJCS8vIHZhciBoZWxwZXIgPSBuZXcgVEhSRUUuQ2FtZXJhSGVscGVyKHRoaXMuY2FtZXJhKTsKCQkJLy8gdGhpcy5zY2VuZS5hZGQoaGVscGVyKTsKCgkJCS8vUmVuZGVyZXIKCQkJdGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzOiB0cnVlIH0pOwoJCQl0aGlzLnJlbmRlcmVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7CgkJCXRoaXMucmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgPSB0cnVlOwoJCQkvLyB0aGlzLnJlbmRlcmVyLnNoYWRvd01hcC50eXBlID0gVEhSRUUuQmFzaWNTaGFkb3dNYXA7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aXN1YWxpemVyIikuYXBwZW5kQ2hpbGQodGhpcy5yZW5kZXJlci5kb21FbGVtZW50KTsKCgkJCS8vIENvbnRyb2xzCgkJCXRoaXMuYWRkQ29udHJvbHMoKTsKCQkJdGhpcy5zZXRDb250cm9scyh0cnVlKTsKCgkJCS8vIFJheWNhc3RlcgoJCQl0aGlzLnJheWNhc3RlciA9IG5ldyBUSFJFRS5SYXljYXN0ZXIoKTsKCgkJCS8vIEdyb3VuZAoJCQlsZXQgZ3JpZFdpZHRoID0gdGhpcy5jb2xzICogdGhpcy5ub2RlRGltZW5zaW9ucy53aWR0aCwKCQkJCWdyaWRIZWlnaHQgPSB0aGlzLnJvd3MgKiB0aGlzLm5vZGVEaW1lbnNpb25zLmhlaWdodDsKCQkJbGV0IHZtID0gdGhpczsKCQkJbGV0IGdyb3VuZEdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoZ3JpZFdpZHRoLCBncmlkSGVpZ2h0LCB0aGlzLmNvbHMsIHRoaXMucm93cyk7CgkJCWdyb3VuZEdlb21ldHJ5LnJvdGF0ZVgoLU1hdGguUEkgLyAyKTsKCQkJbGV0IGxvYWRlciA9IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCk7CgkJCWxvYWRlci5sb2FkKAoJCQkJcmVxdWlyZSgiQC9hc3NldHMvdGV4dHVyZXMvZ3JvdW5kLnBuZyIpLAoJCQkJZnVuY3Rpb24odGV4dHVyZSkgewoJCQkJCXRleHR1cmUud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKCQkJCQl0ZXh0dXJlLndyYXBUID0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7CgkJCQkJdGV4dHVyZS5yZXBlYXQueCA9IHZtLnJvd3M7CgkJCQkJdGV4dHVyZS5yZXBlYXQueSA9IHZtLmNvbHM7CgkJCQkJdmFyIGdyb3VuZE1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoewoJCQkJCQltYXA6IHRleHR1cmUsCgkJCQkJCXNpZGU6IFRIUkVFLkZyb250U2lkZSwKCQkJCQkJdmVydGV4Q29sb3JzOiBUSFJFRS5GYWNlQ29sb3JzLAoJCQkJCX0pOwoJCQkJCXZtLmdyb3VuZCA9IG5ldyBUSFJFRS5NZXNoKGdyb3VuZEdlb21ldHJ5LCBncm91bmRNYXRlcmlhbCk7CgkJCQkJdm0uZ3JvdW5kLnJlY2VpdmVTaGFkb3cgPSB0cnVlOwoJCQkJCXZtLmdyb3VuZC5wb3NpdGlvbi55ID0gMC4wMjsKCQkJCQl2bS5zY2VuZS5hZGQodm0uZ3JvdW5kKTsKCQkJCQl2bS5pbml0R3JpZCgpOwoJCQkJCXZtLiRlbWl0KCJncm91bmRJbml0aWFsaXplZCIsIHZtLmdyb3VuZCk7CgkJCQl9LAoJCQkJdW5kZWZpbmVkLAoJCQkJZnVuY3Rpb24oZXJyb3IpIHsKCQkJCQljb25zb2xlLmxvZyhlcnJvcik7CgkJCQl9CgkJCSk7CgkJCWxldCBmYWtlR3JvdW5kR2VvbWV0cnkgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxMDAwLCAxMDAwLCB0aGlzLmNvbHMsIHRoaXMucm93cyk7CgkJCWZha2VHcm91bmRHZW9tZXRyeS5yb3RhdGVYKC1NYXRoLlBJIC8gMik7CgkJCXZhciBmYWtlR3JvdW5kTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7CgkJCQkvLyBjb2xvcjogMHg4Nzc3NWQsCgkJCQljb2xvcjogMHhCQkMyRDAsCgkJCQlzaWRlOiBUSFJFRS5Gcm9udFNpZGUsCgkJCX0pOwoJCQlsZXQgZmFrZUdyb3VuZCA9IG5ldyBUSFJFRS5NZXNoKGZha2VHcm91bmRHZW9tZXRyeSwgZmFrZUdyb3VuZE1hdGVyaWFsKTsKCQkJdGhpcy5zY2VuZS5hZGQoZmFrZUdyb3VuZCk7CgoJCQkvL0dyaWQgaGVscGVyCgkJCXZhciBzaXplID0gdGhpcy5jb2xzICogdGhpcy5ub2RlRGltZW5zaW9ucy5oZWlnaHQ7CgkJCXZhciBkaXZpc2lvbnMgPSB0aGlzLmNvbHM7CgkJCXZhciBncmlkSGVscGVyID0gbmV3IFRIUkVFLkdyaWRIZWxwZXIoc2l6ZSwgZGl2aXNpb25zLCAweDVjNzhiZCwgMHg1Yzc4YmQpOwoJCQlncmlkSGVscGVyLnBvc2l0aW9uLnkgPSAwLjAzNTsKCQkJdGhpcy5zY2VuZS5hZGQoZ3JpZEhlbHBlcik7CgoJCQkvLyBXYWxsCgkJCS8vIGxldCB3YWxsSGVpZ2h0ID0gdGhpcy5ub2RlRGltZW5zaW9ucy53aWR0aCAqIDIgKyBNYXRoLnJhbmRvbSgpICogdGhpcy5ub2RlRGltZW5zaW9ucy53aWR0aCAqIDM7CgkJCWxldCB3YWxsSGVpZ2h0ID0gdGhpcy5ub2RlRGltZW5zaW9ucy5oZWlnaHQgKiAyOwoJCQl0aGlzLndhbGxHZW9tdGVyeSA9IG5ldyBUSFJFRS5Cb3hCdWZmZXJHZW9tZXRyeSgKCQkJCXRoaXMubm9kZURpbWVuc2lvbnMud2lkdGgsCgkJCQl3YWxsSGVpZ2h0LAoJCQkJdGhpcy5ub2RlRGltZW5zaW9ucy5oZWlnaHQKCQkJKTsKCQkJbGV0IHdhbGxUZXh0dXJlT2JqZWN0ID0gdGhpcy53YWxsVGV4dHVyZXNbCgkJCQlNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLndhbGxUZXh0dXJlcy5sZW5ndGgpCgkJCV07CgkJCXRoaXMud2FsbE1hdGVyaWFscy5wdXNoKAoJCQkJbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsKCQkJCQljb2xvcjogbmV3IFRIUkVFLkNvbG9yKHRoaXMuY29sb3JzLndhbGwuciwgdGhpcy5jb2xvcnMud2FsbC5nLCB0aGlzLmNvbG9ycy53YWxsLmIpLAoJCQkJfSkKCQkJKTsKCQkJZm9yIChsZXQgdGV4IG9mIHRoaXMud2FsbFRleHR1cmVzKSB7CgkJCQlsb2FkZXIubG9hZCgKCQkJCQlyZXF1aXJlKCJAL2Fzc2V0cy90ZXh0dXJlcy8iICsgdGV4LnBhdGgpLAoJCQkJCWZ1bmN0aW9uKHRleHR1cmUpIHsKCQkJCQkJdGV4dHVyZS53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwoJCQkJCQl0ZXh0dXJlLnJlcGVhdC55ID0gdGV4LnJlcGVhdFk7CgkJCQkJCXZtLndhbGxNYXRlcmlhbHMucHVzaChuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IG1hcDogdGV4dHVyZSB9KSk7CgkJCQkJfSwKCQkJCQl1bmRlZmluZWQsCgkJCQkJZnVuY3Rpb24oZXJyb3IpIHsKCQkJCQkJY29uc29sZS5sb2coZXJyb3IpOwoJCQkJCX0KCQkJCSk7CgkJCX0KCgkJCS8vIEFtYmllbnQgTGlnaHQKCQkJdGhpcy5hbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KDB4ZmZmZmZmLCAxKTsKCQkJdGhpcy5zY2VuZS5hZGQodGhpcy5hbWJpZW50TGlnaHQpOwoKCQkJLy8gTElHSFRTCgkJCXRoaXMuaGVtaXNwaGVyZUxpZ2h0ID0gbmV3IFRIUkVFLkhlbWlzcGhlcmVMaWdodCgweGZmZmZmZiwgMHhmZmZmZmYsIDAuMSk7CgkJCXRoaXMuaGVtaXNwaGVyZUxpZ2h0LmNvbG9yLnNldEhTTCgwLjYsIDEsIDAuNik7CgkJCXRoaXMuaGVtaXNwaGVyZUxpZ2h0Lmdyb3VuZENvbG9yLnNldEhleCgweDg3Nzc1ZCk7CgkJCXRoaXMuaGVtaXNwaGVyZUxpZ2h0LnBvc2l0aW9uLnNldCgwLCA1LCAwKTsKCQkJdGhpcy5zY2VuZS5hZGQodGhpcy5oZW1pc3BoZXJlTGlnaHQpOwoKCQkJLy8gbGV0IGhlbWlMaWdodEhlbHBlciA9IG5ldyBUSFJFRS5IZW1pc3BoZXJlTGlnaHRIZWxwZXIodGhpcy5oZW1pc3BoZXJlTGlnaHQsIDEwKTsKCQkJLy8gdGhpcy5zY2VuZS5hZGQoaGVtaUxpZ2h0SGVscGVyKTsKCgkJCXRoaXMuZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjUpOwoJCQl0aGlzLmRpcmVjdGlvbmFsTGlnaHQuY29sb3Iuc2V0SFNMKDAuMSwgMSwgMC45NSk7CgkJCXRoaXMuZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoLTEsIDEuNzUsIDEpOwoJCQl0aGlzLmRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24ubXVsdGlwbHlTY2FsYXIoNzApOwoJCQl0aGlzLnNjZW5lLmFkZCh0aGlzLmRpcmVjdGlvbmFsTGlnaHQpOwoKCQkJdGhpcy5kaXJlY3Rpb25hbExpZ2h0LmNhc3RTaGFkb3cgPSB0cnVlOwoJCQl0aGlzLmRpcmVjdGlvbmFsTGlnaHQuc2hhZG93Lm1hcFNpemUud2lkdGggPSAyMDQ4OwoJCQl0aGlzLmRpcmVjdGlvbmFsTGlnaHQuc2hhZG93Lm1hcFNpemUuaGVpZ2h0ID0gMjA0ODsKCgkJCXZhciBkID0gMjAwOwoJCQl0aGlzLmRpcmVjdGlvbmFsTGlnaHQuc2hhZG93LmNhbWVyYS5sZWZ0ID0gLWQ7CgkJCXRoaXMuZGlyZWN0aW9uYWxMaWdodC5zaGFkb3cuY2FtZXJhLnJpZ2h0ID0gZDsKCQkJdGhpcy5kaXJlY3Rpb25hbExpZ2h0LnNoYWRvdy5jYW1lcmEudG9wID0gZDsKCQkJdGhpcy5kaXJlY3Rpb25hbExpZ2h0LnNoYWRvdy5jYW1lcmEuYm90dG9tID0gLWQ7CgkJCXRoaXMuZGlyZWN0aW9uYWxMaWdodC5zaGFkb3cuY2FtZXJhLmZhciA9IDM1MDsKCgkJCS8vIFNLWURPTUUKCQkJdmFyIHZlcnRleFNoYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2ZXJ0ZXhTaGFkZXIiKS50ZXh0Q29udGVudDsKCQkJdmFyIGZyYWdtZW50U2hhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZyYWdtZW50U2hhZGVyIikudGV4dENvbnRlbnQ7CgkJCXZhciB1bmlmb3JtcyA9IHsKCQkJCXRvcENvbG9yOiB7IHZhbHVlOiBuZXcgVEhSRUUuQ29sb3IoMHgwMDc3ZmYpIH0sCgkJCQlib3R0b21Db2xvcjogeyB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKDB4ZmZmZmZmKSB9LAoJCQkJb2Zmc2V0OiB7IHZhbHVlOiAzMyB9LAoJCQkJZXhwb25lbnQ6IHsgdmFsdWU6IDAuNiB9LAoJCQl9OwoJCQl1bmlmb3Jtc1sidG9wQ29sb3IiXS52YWx1ZS5jb3B5KHRoaXMuaGVtaXNwaGVyZUxpZ2h0LmNvbG9yKTsKCgkJCXRoaXMuc2NlbmUuZm9nLmNvbG9yLmNvcHkodW5pZm9ybXNbImJvdHRvbUNvbG9yIl0udmFsdWUpOwoJCQl2YXIgc2t5R2VvID0gbmV3IFRIUkVFLlNwaGVyZUJ1ZmZlckdlb21ldHJ5KDEwMDAsIDMyLCAxNSk7CgkJCXZhciBza3lNYXQgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoewoJCQkJdW5pZm9ybXM6IHVuaWZvcm1zLAoJCQkJdmVydGV4U2hhZGVyOiB2ZXJ0ZXhTaGFkZXIsCgkJCQlmcmFnbWVudFNoYWRlcjogZnJhZ21lbnRTaGFkZXIsCgkJCQlzaWRlOiBUSFJFRS5CYWNrU2lkZSwKCQkJfSk7CgkJCXZhciBza3kgPSBuZXcgVEhSRUUuTWVzaChza3lHZW8sIHNreU1hdCk7CgkJCXRoaXMuc2NlbmUuYWRkKHNreSk7CgoJCQkvLyBTdGF0cwoJCQl0aGlzLnN0YXRzID0gbmV3IFN0YXRzKCk7CgkJCXRoaXMuc3RhdHMuZG9tLnN0eWxlLnRvcCA9ICJhdXRvIjsKCQkJdGhpcy5zdGF0cy5kb20uc3R5bGUuYm90dG9tID0gJzVweCc7CgkJCXRoaXMuc3RhdHMuZG9tLnN0eWxlLmxlZnQgPSAnM3B4JzsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpc3VhbGl6ZXIiKS5hcHBlbmRDaGlsZCh0aGlzLnN0YXRzLmRvbSk7CgoJCQkvL1Jlc2l6ZSBoYW5kbGVyCgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCB0aGlzLnJlc2l6ZUhhbmRsZXIpOwoJCQl0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgdGhpcy5vbk1vdXNlRG93biwgdHJ1ZSk7CgkJCXRoaXMucmVuZGVyZXIuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwgdGhpcy5vbk1vdXNlRG93biwgdHJ1ZSk7CgkJCXRoaXMucmVuZGVyZXIuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCB0aGlzLm9uTW91c2VNb3ZlLCB0cnVlKTsKCQkJdGhpcy5yZW5kZXJlci5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsIHRoaXMub25Nb3VzZU1vdmUsIHRydWUpOwoJCQl0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIHRoaXMub25Nb3VzZXVwLCB0cnVlKTsKCQkJdGhpcy5yZW5kZXJlci5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbGVhdmUiLCB0aGlzLm9uTW91c2VMZWF2ZSwgdHJ1ZSk7CgkJCXRoaXMucmVuZGVyZXIuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGVuZCIsIHRoaXMub25Nb3VzZXVwLCB0cnVlKTsKCgkJCS8vIFNldHRpbmcgaG92ZXIgaGFuZGxlcgoJCQl0aGlzLm1vdXNlID0gbmV3IFRIUkVFLlZlY3RvcjIoKTsKCgkJCXRoaXMucmVuZGVyTG9vcCgpOwoJCX0sCgoJCXJlbmRlckxvb3AoKSB7CgkJCXJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlckxvb3ApOwoJCQlpZiAodGhpcy5jb250cm9sVHlwZSA9PSAiUG9pbnRlckxvY2siKSB7CgkJCQl2YXIgZGVsdGEgPSB0aGlzLmNsb2NrLmdldERlbHRhKCk7CgkJCQl0aGlzLmFuaW1hdGVQbGF5ZXIoZGVsdGEpOwoJCQl9CgkJCWlmICh0aGlzLndvcmxkU2V0dXApIHsKCQkJCXRoaXMuaG92ZXJPYmplY3RMb29wKCk7CgkJCQlpZih0aGlzLnN0cmVhbWluZykgewoJCQkJCXRoaXMuZGV2aWNlQ2FtTG9vcCgpOwoJCQkJfQoJCQl9CgkJCXRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhKTsKCQkJVFdFRU4udXBkYXRlKCk7CgkJCXRoaXMuc3RhdHMudXBkYXRlKCk7CgkJfSwKCgkJaG92ZXJPYmplY3RMb29wKCkgewoJCQlpZiAoIXRoaXMuZG93bikgewoJCQkJdGhpcy5pbnRlcnNlY3RlZE5vZGUgPSBudWxsOwoJCQkJcmV0dXJuOwoJCQl9CgkJCXRoaXMucmF5Y2FzdGVyLnNldEZyb21DYW1lcmEodGhpcy5tb3VzZSwgdGhpcy5jYW1lcmEpOwoJCQl2YXIgaW50ZXJzZWN0cyA9IHRoaXMucmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHModGhpcy5jbGlja2FibGVPYmplY3RzKTsKCQkJaWYgKGludGVyc2VjdHMubGVuZ3RoID4gMCkgewoJCQkJbGV0IGNvb3JkczsKCQkJCWlmIChpbnRlcnNlY3RzWzBdLm9iamVjdC5uYW1lID09ICJ3YWxsIikgewoJCQkJCWNvb3JkcyA9IHRoaXMuZmFjZUluZGV4VG9Db29yZGluYXRlcyhpbnRlcnNlY3RzWzBdLm9iamVjdC53YWxsSWQgKiAyKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIGZhY2VJbmRleCA9IGludGVyc2VjdHNbMF0uZmFjZUluZGV4OwoJCQkJCWNvb3JkcyA9IHRoaXMuZmFjZUluZGV4VG9Db29yZGluYXRlcyhmYWNlSW5kZXgpOwoJCQkJfQoKCQkJCWlmICh0aGlzLmdyaWRbY29vcmRzLnJvd11bY29vcmRzLmNvbF0gIT0gdGhpcy5pbnRlcnNlY3RlZE5vZGUpIHsKCQkJCQlsZXQgZW5kcyA9IFsic3RhcnQiLCAiZmluaXNoIl07CgkJCQkJaWYgKAoJCQkJCQllbmRzLmluY2x1ZGVzKHRoaXMuZ3JpZFtjb29yZHMucm93XVtjb29yZHMuY29sXS5zdGF0dXMpIHx8CgkJCQkJCSh0aGlzLmludGVyc2VjdGVkTm9kZSAmJiBlbmRzLmluY2x1ZGVzKHRoaXMuaW50ZXJzZWN0ZWROb2RlLnN0YXR1cykpCgkJCQkJKSB7CgkJCQkJCWxldCBlbmQ7CgkJCQkJCWlmIChlbmRzLmluY2x1ZGVzKHRoaXMuZ3JpZFtjb29yZHMucm93XVtjb29yZHMuY29sXS5zdGF0dXMpKSB7CgkJCQkJCQllbmQgPSB0aGlzLmdyaWRbY29vcmRzLnJvd11bY29vcmRzLmNvbF0uc3RhdHVzOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZW5kID0gdGhpcy5pbnRlcnNlY3RlZE5vZGUuc3RhdHVzOwoJCQkJCQl9CgkJCQkJCWxldCBvYmogPSB7fTsKCQkJCQkJb2JqW2VuZF0gPSB7CgkJCQkJCQlyb3c6IGNvb3Jkcy5yb3csCgkJCQkJCQljb2w6IGNvb3Jkcy5jb2wsCgkJCQkJCX07CgkJCQkJCWlmICh0aGlzLmludGVyc2VjdGVkTm9kZSAmJiBlbmRzLmluY2x1ZGVzKHRoaXMuaW50ZXJzZWN0ZWROb2RlLnN0YXR1cykpIHsKCQkJCQkJCXRoaXMuaW50ZXJzZWN0ZWROb2RlLnN0YXR1cyA9ICJkZWZhdWx0IjsKCQkJCQkJfQoJCQkJCQl0aGlzLmdyaWRbY29vcmRzLnJvd11bY29vcmRzLmNvbF0uc3RhdHVzID0gZW5kOwoJCQkJCQl0aGlzLiRlbWl0KCJ1cGRhdGVFbmRzIiwgb2JqKTsKCQkJCQl9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRBbGdvcml0aG0udHlwZSAhPSAndW53ZWlnaHRlZCcgJiYgKCF0aGlzLmludGVyc2VjdGVkTm9kZSB8fCAhZW5kcy5pbmNsdWRlcyh0aGlzLmludGVyc2VjdGVkTm9kZS5zdGF0dXMpKSkgewoJCQkJCQl0aGlzLmdyaWRbY29vcmRzLnJvd11bY29vcmRzLmNvbF0uc3RhdHVzID0KCQkJCQkJCXRoaXMuZ3JpZFtjb29yZHMucm93XVtjb29yZHMuY29sXS5zdGF0dXMgPT0gIndhbGwiID8gImRlZmF1bHQiIDogIndhbGwiOwoJCQkJCX0KCgkJCQkJdGhpcy5pbnRlcnNlY3RlZE5vZGUgPSB0aGlzLmdyaWRbY29vcmRzLnJvd11bY29vcmRzLmNvbF07CgkJCQl9CgkJCX0KCQl9LAoKCQlhbmltYXRlUGxheWVyKGRlbHRhKSB7CgkJCWxldCBwbGF5ZXJTcGVlZCA9IDMwMDsKCQkJLy8gR3JhZHVhbCBzbG93ZG93bgoJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnggLT0gdGhpcy5wb2ludGVyTG9jay52ZWxvY2l0eS54ICogMTAuMCAqIGRlbHRhOwoJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnogLT0gdGhpcy5wb2ludGVyTG9jay52ZWxvY2l0eS56ICogMTAuMCAqIGRlbHRhOwoKCQkJaWYgKHRoaXMuZGV0ZWN0UGxheWVyQ29sbGlzaW9uKCkgPT0gZmFsc2UpIHsKCQkJCXRoaXMucG9pbnRlckxvY2suZGlyZWN0aW9uLnogPQoJCQkJCU51bWJlcih0aGlzLnBvaW50ZXJMb2NrLm1vdmVGb3J3YXJkKSAtIE51bWJlcih0aGlzLnBvaW50ZXJMb2NrLm1vdmVCYWNrd2FyZCk7CgkJCQl0aGlzLnBvaW50ZXJMb2NrLmRpcmVjdGlvbi54ID0KCQkJCQlOdW1iZXIodGhpcy5wb2ludGVyTG9jay5tb3ZlUmlnaHQpIC0gTnVtYmVyKHRoaXMucG9pbnRlckxvY2subW92ZUxlZnQpOwoJCQkJdGhpcy5wb2ludGVyTG9jay5kaXJlY3Rpb24ubm9ybWFsaXplKCk7IC8vIHRoaXMgZW5zdXJlcyBjb25zaXN0ZW50IG1vdmVtZW50cyBpbiBhbGwgZGlyZWN0aW9ucwoJCgkJCQlpZiAodGhpcy5wb2ludGVyTG9jay5tb3ZlRm9yd2FyZCB8fCB0aGlzLnBvaW50ZXJMb2NrLm1vdmVCYWNrd2FyZCkKCQkJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnogLT0gdGhpcy5wb2ludGVyTG9jay5kaXJlY3Rpb24ueiAqIHBsYXllclNwZWVkICogZGVsdGE7CgkJCQlpZiAodGhpcy5wb2ludGVyTG9jay5tb3ZlTGVmdCB8fCB0aGlzLnBvaW50ZXJMb2NrLm1vdmVSaWdodCkKCQkJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnggLT0gdGhpcy5wb2ludGVyTG9jay5kaXJlY3Rpb24ueCAqIHBsYXllclNwZWVkICogZGVsdGE7CgkKCQkJCXRoaXMuY29udHJvbHMubW92ZVJpZ2h0KC10aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnggKiBkZWx0YSk7CgkJCQl0aGlzLmNvbnRyb2xzLm1vdmVGb3J3YXJkKC10aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnogKiBkZWx0YSk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnggPSAwOwoJCQkJdGhpcy5wb2ludGVyTG9jay52ZWxvY2l0eS56ID0gMDsKCQkJfQoKCQkJdGhpcy5wb2ludGVyTG9jay52ZWxvY2l0eS55IC09IDkuOCAqIDUwLjAgKiBkZWx0YTsgLy8gNTAuMCA9IG1hc3MKCQkJaWYodGhpcy5kZXRlY3RPbk9iamVjdCgpKSB7CgkJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnkgPSBNYXRoLm1heCgwLCB0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnkpOwoJCQkJdGhpcy5wb2ludGVyTG9jay5jYW5KdW1wID0gdHJ1ZTsKCQkJfQoJCQl0aGlzLmNvbnRyb2xzLmdldE9iamVjdCgpLnBvc2l0aW9uLnkgKz0gdGhpcy5wb2ludGVyTG9jay52ZWxvY2l0eS55ICogZGVsdGE7CgoJCQlpZiAodGhpcy5jb250cm9scy5nZXRPYmplY3QoKS5wb3NpdGlvbi55IDwgdGhpcy5jYW1lcmFZKSB7CgkJCQl0aGlzLnBvaW50ZXJMb2NrLnZlbG9jaXR5LnkgPSAwOwoJCQkJdGhpcy5jb250cm9scy5nZXRPYmplY3QoKS5wb3NpdGlvbi55ID0gdGhpcy5jYW1lcmFZOwoJCQkJdGhpcy5wb2ludGVyTG9jay5jYW5KdW1wID0gdHJ1ZTsKCQkJfQoJCX0sCgoJCWRldGVjdFBsYXllckNvbGxpc2lvbigpIHsKCQkJbGV0IHJvdGF0aW9uTWF0cml4OwoJCQkvLyBHZXQgZGlyZWN0aW9uIG9mIGNhbWVyYQoJCQlsZXQgY2FtZXJhRGlyZWN0aW9uID0gdGhpcy5jb250cm9scy5nZXREaXJlY3Rpb24obmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCkpLmNsb25lKCk7CgkJCWxldCBjb2xsaXNpb25EaXN0YW5jZSA9IDE7CgoJCQkvLyBDaGVjayB3aGljaCBkaXJlY3Rpb24gd2UncmUgbW92aW5nIChub3QgbG9va2luZykKCQkJLy8gRmxpcCBtYXRyaXggdG8gdGhhdCBkaXJlY3Rpb24gc28gdGhhdCB3ZSBjYW4gcmVwb3NpdGlvbiB0aGUgcmF5CgkJCWlmICh0aGlzLnBvaW50ZXJMb2NrLm1vdmVCYWNrd2FyZCkgewoJCQkJcm90YXRpb25NYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpOwoJCQkJcm90YXRpb25NYXRyaXgubWFrZVJvdGF0aW9uWSh0aGlzLmRlZ3JlZXNUb1JhZGlhbnMoMTgwKSk7CgkJCX0gZWxzZSBpZiAodGhpcy5wb2ludGVyTG9jay5tb3ZlTGVmdCkgewoJCQkJcm90YXRpb25NYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpOwoJCQkJcm90YXRpb25NYXRyaXgubWFrZVJvdGF0aW9uWSh0aGlzLmRlZ3JlZXNUb1JhZGlhbnMoOTApKTsKCQkJfSBlbHNlIGlmICh0aGlzLnBvaW50ZXJMb2NrLm1vdmVSaWdodCkgewoJCQkJcm90YXRpb25NYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpOwoJCQkJcm90YXRpb25NYXRyaXgubWFrZVJvdGF0aW9uWSh0aGlzLmRlZ3JlZXNUb1JhZGlhbnMoMjcwKSk7CgkJCX0KCgkJCS8vIFBsYXllciBpcyBub3QgbW92aW5nIGZvcndhcmQsIGFwcGx5IHJvdGF0aW9uIG1hdHJpeCBuZWVkZWQKCQkJaWYgKHJvdGF0aW9uTWF0cml4ICE9PSB1bmRlZmluZWQpIHsKCQkJCWNhbWVyYURpcmVjdGlvbi5hcHBseU1hdHJpeDQocm90YXRpb25NYXRyaXgpOwoJCQl9CgoJCQkvLyBBcHBseSByYXkgdG8gcGxheWVyIGNhbWVyYQoJCQlsZXQgcmF5Q2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3Rlcih0aGlzLmNvbnRyb2xzLmdldE9iamVjdCgpLnBvc2l0aW9uLCBjYW1lcmFEaXJlY3Rpb24pOwoKCQkJLy8gSWYgb3VyIHJheSBoaXQgYSBjb2xsaWRhYmxlIG9iamVjdCwgcmV0dXJuIHRydWUKCQkJaWYgKHRoaXMucmF5SW50ZXJzZWN0KHJheUNhc3RlciwgY29sbGlzaW9uRGlzdGFuY2UpKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0sCgoJCWRldGVjdE9uT2JqZWN0KCkgewoJCQlsZXQgY29sbGlzaW9uRGlzdGFuY2UgPSB0aGlzLmNhbWVyYVkrMTsKCQkJbGV0IHJheUNhc3RlciA9IG5ldyBUSFJFRS5SYXljYXN0ZXIodGhpcy5jb250cm9scy5nZXRPYmplY3QoKS5wb3NpdGlvbiwgbmV3IFRIUkVFLlZlY3RvcjMoMCwgLTEsIDApKTsKCQkJLy8gcmF5Q2FzdGVyLnJheS5vcmlnaW4ueSAtPSB0aGlzLmNhbWVyYVk7CgkJCWlmICh0aGlzLnJheUludGVyc2VjdChyYXlDYXN0ZXIsIGNvbGxpc2lvbkRpc3RhbmNlKSkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9LAoKCQlkZXZpY2VDYW1Mb29wKCkgewoJCQlsZXQgdmlkZW9DdHggPSB0aGlzLnZpZGVvQ2FudmFzLmdldENvbnRleHQoIjJkIik7CgoJCQl2aWRlb0N0eC5kcmF3SW1hZ2UodGhpcy52aWRlbywgMCwgMCwgdGhpcy52aWRlb0NhbnZhcy53aWR0aCwgdGhpcy52aWRlb0NhbnZhcy5oZWlnaHQpOwoJCQlsZXQgcGl4ZWxzID0gdmlkZW9DdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMudmlkZW9DYW52YXMud2lkdGgsIHRoaXMudmlkZW9DYW52YXMuaGVpZ2h0KTsKCQkJZm9yKGxldCB5PTA7IHk8dGhpcy52aWRlb0NhbnZhcy5oZWlnaHQ7IHkrKykgewoJCQkJZm9yKGxldCB4PTA7IHg8dGhpcy52aWRlb0NhbnZhcy53aWR0aDsgeCsrKSB7CgkJCQkJbGV0IGluZGV4ID0gKHggKyB5ICogdGhpcy52aWRlb0NhbnZhcy53aWR0aCkgKiA0OwoJCQkJCWxldCByID0gcGl4ZWxzLmRhdGFbaW5kZXgrMF07CgkJCQkJbGV0IGcgPSBwaXhlbHMuZGF0YVtpbmRleCsxXTsKCQkJCQlsZXQgYiA9IHBpeGVscy5kYXRhW2luZGV4KzJdOwoJCQkJCQoJCQkJCWxldCBicmlnaHRuZXNzID0gTWF0aC5mbG9vcigocitnK2IpLzMpOwoJCQkJCWxldCBncmlkWCA9IE1hdGguZmxvb3IodGhpcy52aWRlb0NhbnZhcy53aWR0aC0xLXgpOwoJCQkJCWxldCBzdGF0dXMgPSAiZGVmYXVsdCI7CgkJCQkJaWYgKHkgPT0gdGhpcy5zdGFydC5yb3cgJiYgZ3JpZFggPT0gdGhpcy5zdGFydC5jb2wpIHsKCQkJCQkJc3RhdHVzID0gInN0YXJ0IjsKCQkJCQl9IGVsc2UgaWYgKHkgPT0gdGhpcy5maW5pc2gucm93ICYmIGdyaWRYID09IHRoaXMuZmluaXNoLmNvbCkgewoJCQkJCQlzdGF0dXMgPSAiZmluaXNoIjsKCQkJCQl9CgkJCQkJaWYoYnJpZ2h0bmVzcyA+IHRoaXMudGhyZXNob2xkVmFsdWUpIHsKCQkJCQkJdGhpcy5ncmlkW3ldW2dyaWRYXS5zdGF0dXMgPSBzdGF0dXM7CgkJCQkJfSBlbHNlIGlmKHN0YXR1cyAhPSAnc3RhcnQnICYmIHN0YXR1cyAhPSAnZmluaXNoJykgewoJCQkJCQl0aGlzLmdyaWRbeV1bZ3JpZFhdLnN0YXR1cyA9ICd3YWxsJzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9LAoKCQlyYXlJbnRlcnNlY3QocmF5LCBkaXN0YW5jZSkgewoJCQl2YXIgaW50ZXJzZWN0cyA9IHJheS5pbnRlcnNlY3RPYmplY3RzKHRoaXMuY29sbGlkYWJsZU9iamVjdHMpOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGludGVyc2VjdHMubGVuZ3RoOyBpKyspIHsKCQkJCS8vIENoZWNrIGlmIHRoZXJlJ3MgYSBjb2xsaXNpb24KCQkJCWlmIChpbnRlcnNlY3RzW2ldLmRpc3RhbmNlIDwgZGlzdGFuY2UpIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfSwKCgkJYWRkQ29udHJvbHMoKSB7CgkJCXRoaXMub3JiaXRDb250cm9scyA9IG5ldyBPcmJpdENvbnRyb2xzKHRoaXMuY2FtZXJhLCB0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpOwoJCQl0aGlzLnBvaW50ZXJMb2NrQ29udHJvbHMgPSBuZXcgUG9pbnRlckxvY2tDb250cm9scyh0aGlzLmNhbWVyYSwgdGhpcy5yZW5kZXJlci5kb21FbGVtZW50KTsKCQkJdGhpcy5wb2ludGVyTG9ja0NvbnRyb2xzLmFkZEV2ZW50TGlzdGVuZXIoImxvY2siLCBmdW5jdGlvbigpIHsKCQkJCWNvbnNvbGUubG9nKCJQb2ludGVyIExvY2tlZCIpOwoJCQl9KTsKCQkJdGhpcy5wb2ludGVyTG9ja0NvbnRyb2xzLmFkZEV2ZW50TGlzdGVuZXIoInVubG9jayIsIGZ1bmN0aW9uKCkgewoJCQkJY29uc29sZS5sb2coIlBvaW50ZXIgVW5sb2NrZWQiKTsKCQkJfSk7CgkJCS8vIENsb2NrCgkJCXRoaXMuY2xvY2sgPSBuZXcgVEhSRUUuQ2xvY2soKTsKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIHRoaXMub25LZXlEb3duLCBmYWxzZSk7CgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgdGhpcy5vbktleVVwLCBmYWxzZSk7CgkJCXRoaXMucG9pbnRlckxvY2sudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoJCQl0aGlzLnBvaW50ZXJMb2NrLmRpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgkJCXRoaXMuc2NlbmUuYWRkKHRoaXMucG9pbnRlckxvY2tDb250cm9scy5nZXRPYmplY3QoKSk7CgkJfSwKCgkJc2V0Q29udHJvbHMoZnJvbUluaXQgPSBmYWxzZSkgewoJCQlsZXQgdm0gPSB0aGlzOwoJCQlUV0VFTi5yZW1vdmVBbGwoKTsKCQkJaWYgKHRoaXMuY29udHJvbFR5cGUgPT0gIk9yYml0IikgewoJCQkJLy8gT3JiaXRDb250cm9scwoJCQkJdGhpcy5jYW1lcmFZID0gdGhpcy5kZWZhdWx0Q2FtZXJhWTsKCQkJCXRoaXMuY2FtZXJhLm5lYXIgPSAxOwoJCQkJdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoJCQkJdGhpcy5jb250cm9scyA9IHRoaXMub3JiaXRDb250cm9sczsKCQkJCXRoaXMuY29udHJvbHMuZW5hYmxlZCA9IHRydWU7CgkJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCQl2bS5yZXNldENhbWVyYSgpOwoJCQkJfSwgZnJvbUluaXQgPyA4MDAgOiAwKTsKCQkJfSBlbHNlIGlmICh0aGlzLmNvbnRyb2xUeXBlID09ICJQb2ludGVyTG9jayIpIHsKCQkJCS8vIFBvaW50ZXJMb2NrIGNvbnRyb2xzCgkJCQl0aGlzLmNhbWVyYVkgPSAzOwoJCQkJdGhpcy5jYW1lcmEubmVhciA9IDAuMDU7CgkJCQl0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgkJCQl0aGlzLmNvbnRyb2xzLmVuYWJsZWQgPSBmYWxzZTsKCQkJCXRoaXMuY29udHJvbHMgPSB0aGlzLnBvaW50ZXJMb2NrQ29udHJvbHM7CgkJCQlsZXQgc3RhcnRQb3NpdGlvbiA9IHRoaXMuZ3JvdW5kLmdlb21ldHJ5LnZlcnRpY2VzWwoJCQkJCXRoaXMuZ3JpZFt0aGlzLnN0YXJ0LnJvd11bdGhpcy5zdGFydC5jb2xdLmZhY2VzWzFdWyJhIl0KCQkJCV07CgkJCQluZXcgVFdFRU4uVHdlZW4odGhpcy5jYW1lcmEucG9zaXRpb24pCgkJCQkJLnRvKHN0YXJ0UG9zaXRpb24sIDIwMDApCgkJCQkJLmVhc2luZyhUV0VFTi5FYXNpbmcuRXhwb25lbnRpYWwuT3V0KQoJCQkJCS5zdGFydCgpOwoJCQkJbmV3IFRXRUVOLlR3ZWVuKHRoaXMuY2FtZXJhLnJvdGF0aW9uKQoJCQkJCS50byh7IHg6IDAsIHk6ICg1ICogTWF0aC5QSSkgLyA0LCB6OiAwIH0sIDIwMDApCgkJCQkJLmVhc2luZyhUV0VFTi5FYXNpbmcuRXhwb25lbnRpYWwuT3V0KQoJCQkJCS5zdGFydCgpOwoJCQl9CgkJfSwKCgkJcmVzZXRDYW1lcmEoKSB7CgkJCW5ldyBUV0VFTi5Ud2Vlbih0aGlzLmNhbWVyYS5wb3NpdGlvbikKCQkJCS50byh7IHg6IDAsIHk6IHRoaXMuY2FtZXJhWSwgejogMCB9LCAyMDAwKQoJCQkJLmVhc2luZyhUV0VFTi5FYXNpbmcuRXhwb25lbnRpYWwuT3V0KQoJCQkJLm9uVXBkYXRlKCgpID0+IHsKCQkJCQl0aGlzLmNhbWVyYS5sb29rQXQodGhpcy5zY2VuZS5wb3NpdGlvbik7CgkJCQl9KQoJCQkJLm9uQ29tcGxldGUoKCkgPT4gewoJCQkJCWxldCBsb29rRGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCQkJCQl0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihsb29rRGlyZWN0aW9uKTsKCQkJCQl0aGlzLmNvbnRyb2xzLnRhcmdldAoJCQkJCQkuY29weSh0aGlzLmNhbWVyYS5wb3NpdGlvbikKCQkJCQkJLmFkZChsb29rRGlyZWN0aW9uLm11bHRpcGx5U2NhbGFyKHRoaXMuY2FtZXJhWSkpOwoJCQkJfSkKCQkJCS5zdGFydCgpOwoJCQluZXcgVFdFRU4uVHdlZW4odGhpcy5jYW1lcmEucm90YXRpb24pCgkJCQkudG8oeyB4OiAtTWF0aC5QSSAvIDIsIHk6IDAsIHo6IDAgfSwgMjAwMCkKCQkJCS5lYXNpbmcoVFdFRU4uRWFzaW5nLkV4cG9uZW50aWFsLk91dCkKCQkJCS5zdGFydCgpOwoJCX0sCgoJCXJlc2l6ZUhhbmRsZXIoZXZlbnQpIHsKCQkJbGV0IHdpZHRoID0gd2luZG93LmlubmVyV2lkdGgsCgkJCQloZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJCXRoaXMucmVuZGVyZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTsKCQkJdGhpcy5jYW1lcmEuYXNwZWN0ID0gd2lkdGggLyBoZWlnaHQ7CgkJCXRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCQl9LAoKCQlpbml0R3JpZCgpIHsKCQkJbGV0IHZtID0gdGhpczsKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJvd3M7IGkrKykgewoJCQkJbGV0IGN1cnJlbnRSb3cgPSBbXTsKCQkJCWZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5jb2xzOyBqKyspIHsKCQkJCQlsZXQgbm9kZSA9IHRoaXMuY3JlYXRlTm9kZShpLCBqKTsKCQkJCQljdXJyZW50Um93LnB1c2gobm9kZSk7CgkJCQl9CgkJCQl0aGlzLmdyaWQucHVzaChjdXJyZW50Um93KTsKCQkJfQoJCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucm93czsgaSsrKSB7CgkJCQlmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuY29sczsgaisrKSB7CgkJCQkJdGhpcy4kd2F0Y2goCgkJCQkJCWZ1bmN0aW9uKCkgewoJCQkJCQkJcmV0dXJuIHRoaXMuZ3JpZFtpXVtqXTsKCQkJCQkJfSwKCQkJCQkJdGhpcy5ub2RlV2F0Y2hlciwKCQkJCQkJeyBkZWVwOiB0cnVlIH0KCQkJCQkpOwoJCQkJfQoJCQl9CgkJfSwKCgkJY3JlYXRlTm9kZShyb3csIGNvbCkgewoJCQlsZXQgZmFjZXMgPSB7fTsKCQkJbGV0IGZhY2VJbmRleCA9IHJvdyAqIDIgKiB0aGlzLmNvbHMgKyBjb2wgKiAyOwoJCQlmYWNlc1sxXSA9IHRoaXMuZ3JvdW5kLmdlb21ldHJ5LmZhY2VzW2ZhY2VJbmRleF07CgkJCWZhY2VJbmRleCA9IGZhY2VJbmRleCAlIDIgPT0gMCA/IGZhY2VJbmRleCArIDEgOiBmYWNlSW5kZXggLSAxOwoJCQlmYWNlc1syXSA9IHRoaXMuZ3JvdW5kLmdlb21ldHJ5LmZhY2VzW2ZhY2VJbmRleF07CgoJCQlsZXQgc3RhdHVzID0gImRlZmF1bHQiOwoJCQlpZiAocm93ID09IHRoaXMuc3RhcnQucm93ICYmIGNvbCA9PSB0aGlzLnN0YXJ0LmNvbCkgewoJCQkJc3RhdHVzID0gInN0YXJ0IjsKCQkJfSBlbHNlIGlmIChyb3cgPT0gdGhpcy5maW5pc2gucm93ICYmIGNvbCA9PSB0aGlzLmZpbmlzaC5jb2wpIHsKCQkJCXN0YXR1cyA9ICJmaW5pc2giOwoJCQl9CgoJCQkvLyBOb2RlIGluZm8KCQkJbGV0IG5vZGUgPSB7CgkJCQlpZDogcm93ICogdGhpcy5jb2xzICsgY29sLAoJCQkJcm93OiByb3csCgkJCQljb2w6IGNvbCwKCQkJCWZhY2VzOiBmYWNlcywKCQkJCXN0YXR1czogc3RhdHVzLAoJCQkJZGlzdGFuY2U6IEluZmluaXR5LAoJCQkJdG90YWxEaXN0YW5jZTogSW5maW5pdHksCgkJCQloZXVyaXN0aWNEaXN0YW5jZTogbnVsbCwKCQkJCWRpcmVjdGlvbjogbnVsbCwKCQkJCXdlaWdodDogMCwKCQkJCXByZXZpb3VzTm9kZTogbnVsbCwKCQkJfTsKCgkJCWlmIChzdGF0dXMgPT0gInN0YXJ0IikgewoJCQkJdHdlZW5Ub0NvbG9yKG5vZGUsIHRoaXMuZ3JvdW5kLmdlb21ldHJ5LCBbdGhpcy5jb2xvcnMuc3RhcnRdKTsKCQkJfSBlbHNlIGlmIChzdGF0dXMgPT0gImZpbmlzaCIpIHsKCQkJCXR3ZWVuVG9Db2xvcihub2RlLCB0aGlzLmdyb3VuZC5nZW9tZXRyeSwgW3RoaXMuY29sb3JzLmZpbmlzaF0pOwoJCQl9CgoJCQlyZXR1cm4gbm9kZTsKCQl9LAoKCQlub2RlV2F0Y2hlcihuZXdWYWwsIG9sZFZhbCkgewoJCQkvLyBjb25zb2xlLmxvZygnV0FUQ0hFUicsIG5ld1ZhbCk7CgkJCWlmICh0aGlzLnZpc3VhbGl6ZXJTdGF0ZSA9PSAicnVubmluZyIpIHJldHVybjsKCQkJdGhpcy51cGRhdGVOb2RlKG5ld1ZhbCwgdGhpcy5zdHJlYW1pbmcpOwoJCX0sCgoJCXVwZGF0ZU5vZGUobm9kZSwgaW5zdGFudCA9IGZhbHNlKSB7CgkJCWlmIChub2RlLnN0YXR1cyA9PSAid2FsbCIpIHsKCQkJCWxldCBzY2FsZVkgPSAwLjUgKyBNYXRoLnJhbmRvbSgpOwoJCQkJaWYoIWluc3RhbnQpIHsKCQkJCQl0aGlzLmFkZFdhbGwobm9kZSwgc2NhbGVZLCBpbnN0YW50ID8gMCA6IDEwMDApOwoJCQkJfQoJCQkJdHdlZW5Ub0NvbG9yKG5vZGUsIHRoaXMuZ3JvdW5kLmdlb21ldHJ5LCBbdGhpcy5jb2xvcnMud2FsbF0pOwoJCQl9IGVsc2UgaWYgKG5vZGUuc3RhdHVzID09ICJzdGFydCIpIHsKCQkJCXR3ZWVuVG9Db2xvcihub2RlLCB0aGlzLmdyb3VuZC5nZW9tZXRyeSwgW3RoaXMuY29sb3JzLnN0YXJ0XSk7CgkJCX0gZWxzZSBpZiAobm9kZS5zdGF0dXMgPT0gImZpbmlzaCIpIHsKCQkJCXR3ZWVuVG9Db2xvcihub2RlLCB0aGlzLmdyb3VuZC5nZW9tZXRyeSwgW3RoaXMuY29sb3JzLmZpbmlzaF0pOwoJCQl9IGVsc2UgaWYgKG5vZGUuc3RhdHVzID09ICJ2aXNpdGVkIikgewoJCQkJdHdlZW5Ub0NvbG9yKG5vZGUsIHRoaXMuZ3JvdW5kLmdlb21ldHJ5LCBbdGhpcy5jb2xvcnMudmlzaXRlZF0pOwoJCQl9IGVsc2UgewoJCQkJaWYgKHRoaXMud2FsbHNbbm9kZS5pZF0gIT0gbnVsbCAmJiB0aGlzLndhbGxzW25vZGUuaWRdLnZpc2libGUgJiYgIWluc3RhbnQpIHsKCQkJCQl0aGlzLmhpZGVXYWxsKHRoaXMud2FsbHNbbm9kZS5pZF0pOwoJCQkJfQoJCQkJdHdlZW5Ub0NvbG9yKG5vZGUsIHRoaXMuZ3JvdW5kLmdlb21ldHJ5LCBbdGhpcy5jb2xvcnMuZGVmYXVsdF0pOwoJCQl9CgkJfSwKCgkJYWRkV2FsbChub2RlLCBzY2FsZVksIGR1cmF0aW9uKSB7CgkJCWlmICghIXRoaXMud2FsbHNbbm9kZS5pZF0pIHsKCQkJCWlmKCF0aGlzLndhbGxzW25vZGUuaWRdLnZpc2libGUpIHsKCQkJCQl0aGlzLnNob3dXYWxsKHRoaXMud2FsbHNbbm9kZS5pZF0sIHNjYWxlWSwgZHVyYXRpb24pOwoJCQkJfQoJCQkJcmV0dXJuOwoJCQl9CgoJCQlsZXQgbWF0ZXJpYWxJZCA9IDEgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy53YWxsTWF0ZXJpYWxzLmxlbmd0aCAtIDEpKTsKCQkJbGV0IHdhbGwgPSBuZXcgVEhSRUUuTWVzaCh0aGlzLndhbGxHZW9tdGVyeSwgdGhpcy53YWxsTWF0ZXJpYWxzW21hdGVyaWFsSWRdKTsKCQkJd2FsbC5uYW1lID0gIndhbGwiOwoJCQl3YWxsLndhbGxJZCA9IG5vZGUuaWQ7CgkJCXdhbGwuc2NhbGUueSA9IHNjYWxlWTsKCQkJd2FsbC5jYXN0U2hhZG93ID0gdHJ1ZTsKCQkJd2FsbC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTsKCQkJdGhpcy5zY2VuZS5hZGQod2FsbCk7CgkJCXRoaXMuJHNldCh0aGlzLndhbGxzLCBub2RlLmlkLCB3YWxsKTsKCgkJCWxldCBncmlkV2lkdGggPSB0aGlzLmNvbHMgKiB0aGlzLm5vZGVEaW1lbnNpb25zLndpZHRoOwoJCQlsZXQgZ3JpZEhlaWdodCA9IHRoaXMucm93cyAqIHRoaXMubm9kZURpbWVuc2lvbnMuaGVpZ2h0OwoJCQlsZXQgaGVpZ2h0ID0gdGhpcy53YWxsR2VvbXRlcnkucGFyYW1ldGVycy5oZWlnaHQgKiB3YWxsLnNjYWxlLnk7CgkJCWxldCB4ID0gLWdyaWRXaWR0aCAvIDIgKyB0aGlzLm5vZGVEaW1lbnNpb25zLndpZHRoIC8gMiArIG5vZGUuY29sICogdGhpcy5ub2RlRGltZW5zaW9ucy53aWR0aCwKCQkJCXkgPSBoZWlnaHQgLyAyLAoJCQkJeiA9CgkJCQkJLWdyaWRIZWlnaHQgLyAyICsgdGhpcy5ub2RlRGltZW5zaW9ucy5oZWlnaHQgLyAyICsgbm9kZS5yb3cgKiB0aGlzLm5vZGVEaW1lbnNpb25zLmhlaWdodDsKCQkJCgkJCWlmKGR1cmF0aW9uID09IDApIHsKCQkJCXdhbGwucG9zaXRpb24uc2V0KHgsIHksIHopOwoJCQl9IGVsc2UgewoJCQkJd2FsbC5wb3NpdGlvbi5zZXQoeCwgaGVpZ2h0LCB6KTsKCQkJCW5ldyBUV0VFTi5Ud2Vlbih3YWxsLnBvc2l0aW9uKQoJCQkJCS50byh7IHg6IHgsIHk6IHksIHo6IHogfSwgZHVyYXRpb24pCgkJCQkJLmVhc2luZyhUV0VFTi5FYXNpbmcuQm91bmNlLk91dCkKCQkJCQkuc3RhcnQoKTsKCQkJfQoJCX0sCgoJCXNob3dXYWxsKHdhbGwsIHNjYWxlWSwgZHVyYXRpb24pIHsKCQkJd2FsbC5zY2FsZS55ID0gc2NhbGVZOwoJCQlsZXQgaGVpZ2h0ID0gd2FsbC5nZW9tZXRyeS5wYXJhbWV0ZXJzLmhlaWdodCAqIHdhbGwuc2NhbGUueTsKCQkJd2FsbC52aXNpYmxlID0gdHJ1ZTsKCQkJaWYoZHVyYXRpb24gPT0gMCkgewoJCQkJd2FsbC5wb3NpdGlvbi5zZXRZKGhlaWdodC8yKTsKCQkJfSBlbHNlIHsKCQkJCXdhbGwucG9zaXRpb24uc2V0WShoZWlnaHQpOwoJCQkJbmV3IFRXRUVOLlR3ZWVuKHdhbGwucG9zaXRpb24pCgkJCQkJLnRvKHsgeTogaGVpZ2h0IC8gMiB9LCBkdXJhdGlvbikKCQkJCQkuZWFzaW5nKFRXRUVOLkVhc2luZy5Cb3VuY2UuT3V0KQoJCQkJCS5zdGFydCgpOwoJCQl9CgkJfSwKCgkJaGlkZVdhbGwod2FsbCkgewoJCQl3YWxsLnZpc2libGUgPSBmYWxzZTsKCQl9LAoKCQlvbk1vdXNlRG93bihldmVudCkgewoJCQl0aGlzLmRvd24gPSB0cnVlOwoJCQl0aGlzLm1vdmVkID0gZmFsc2U7CgkJCXRoaXMuY3VycmVudEV2ZW50ID0gZXZlbnQ7CgkJCXRoaXMuc2V0TW91c2VWZWN0b3IoZXZlbnQsICJtb3ZlIik7CgkJCXRoaXMuY2xlYXJGb2N1cygpOwoJCX0sCgkJb25Nb3VzZU1vdmUoZXZlbnQpIHsKCQkJaWYgKCF0aGlzLmRvd24pIHJldHVybjsKCQkJdGhpcy5tb3ZlZCA9IHRydWU7CgkJCWlmICh0aGlzLndvcmxkU2V0dXApIHsKCQkJCXRoaXMuc2V0TW91c2VWZWN0b3IoZXZlbnQsICJtb3ZlIik7CgkJCX0KCQl9LAoJCW9uTW91c2VMZWF2ZSgpIHsKCQkJaWYgKHRoaXMubW92ZWQpIHsKCQkJCXRoaXMub25Nb3VzZXVwKCk7CgkJCX0KCQkJdGhpcy5kb3duID0gZmFsc2U7CgkJfSwKCQlvbk1vdXNldXAoZXZlbnQpIHsKCQkJbGV0IHRocmVzaG9sZCA9IDI1OwoJCQlpZiAodGhpcy5tb3ZlZCkgewoJCQkJbGV0IGRpc3QgPSAwOwoJCQkJaWYgKHRoaXMuY3VycmVudEV2ZW50LnRvdWNoZXMgJiYgdGhpcy5jdXJyZW50RXZlbnQudG91Y2hlcy5sZW5ndGggPiAwKSB7CgkJCQkJZGlzdCA9IHRoaXMuY2FsY0Rpc3QoCgkJCQkJCXRoaXMuY3VycmVudEV2ZW50LnRvdWNoZXNbMF0ucGFnZVggLSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCwKCQkJCQkJdGhpcy5jdXJyZW50RXZlbnQudG91Y2hlc1swXS5wYWdlWSAtIGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZCgkJCQkJKTsKCQkJCQlkaXN0ID4gdGhyZXNob2xkID8gdGhpcy5tb3ZlSGFuZGxlcihldmVudCkgOiB0aGlzLmNsaWNrSGFuZGxlcihldmVudCk7CgkJCQl9IGVsc2UgewoJCQkJCXRoaXMubW92ZUhhbmRsZXIoZXZlbnQpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJdGhpcy5jbGlja0hhbmRsZXIoZXZlbnQpOwoJCQl9CgkJCXRoaXMuY3VycmVudEV2ZW50ID0gbnVsbDsKCQkJdGhpcy5tb3ZlZCA9IGZhbHNlOwoJCQl0aGlzLmRvd24gPSBmYWxzZTsKCQl9LAoKCQljYWxjRGlzdCh4LCB5KSB7CgkJCXJldHVybiB4ICogeCArIHkgKiB5OwoJCX0sCgoJCXNldE1vdXNlVmVjdG9yKGV2ZW50LCB0eXBlKSB7CgkJCWxldCB0b3VjaEV2ZW50ID0gdHlwZSA9PSAiY2xpY2siID8gdGhpcy5jdXJyZW50RXZlbnQgOiBldmVudDsKCQkJaWYgKHRvdWNoRXZlbnQudG91Y2hlcyAmJiB0b3VjaEV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMCkgewoJCQkJdGhpcy5tb3VzZS54ID0gKHRvdWNoRXZlbnQudG91Y2hlc1swXS5jbGllbnRYIC8gd2luZG93LmlubmVyV2lkdGgpICogMiAtIDE7CgkJCQl0aGlzLm1vdXNlLnkgPSAtKHRvdWNoRXZlbnQudG91Y2hlc1swXS5jbGllbnRZIC8gd2luZG93LmlubmVySGVpZ2h0KSAqIDIgKyAxOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5tb3VzZS54ID0gKGV2ZW50LmNsaWVudFggLyB3aW5kb3cuaW5uZXJXaWR0aCkgKiAyIC0gMTsKCQkJCXRoaXMubW91c2UueSA9IC0oZXZlbnQuY2xpZW50WSAvIHdpbmRvdy5pbm5lckhlaWdodCkgKiAyICsgMTsKCQkJfQoJCX0sCgoJCW1vdmVIYW5kbGVyKGV2ZW50KSB7CgkJCS8vIGNvbnNvbGUubG9nKCJNb3ZlZCIpOwoJCX0sCgoJCWNsaWNrSGFuZGxlcihldmVudCkgewoJCQlpZiAodGhpcy53b3JsZFNldHVwIHx8IHRoaXMuY29udHJvbFR5cGUgPT0gIlBvaW50ZXJMb2NrIikgcmV0dXJuOwoJCQl0aGlzLnNldE1vdXNlVmVjdG9yKGV2ZW50LCAiY2xpY2siKTsKCQkJdGhpcy5yYXljYXN0ZXIuc2V0RnJvbUNhbWVyYSh0aGlzLm1vdXNlLCB0aGlzLmNhbWVyYSk7CgkJCWxldCBpbnRlcnNlY3RzID0gdGhpcy5yYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0cyh0aGlzLmNsaWNrYWJsZU9iamVjdHMpOyAvL2FycmF5CgkJCWlmIChpbnRlcnNlY3RzLmxlbmd0aCA+IDApIHsKCQkJCWxldCBjb29yZHM7CgkJCQlpZiAoaW50ZXJzZWN0c1swXS5vYmplY3QubmFtZSA9PSAid2FsbCIpIHsKCQkJCQljb29yZHMgPSB0aGlzLmZhY2VJbmRleFRvQ29vcmRpbmF0ZXMoaW50ZXJzZWN0c1swXS5vYmplY3Qud2FsbElkICogMik7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBmYWNlSW5kZXggPSBpbnRlcnNlY3RzWzBdLmZhY2VJbmRleDsKCQkJCQljb25zb2xlLmxvZyhmYWNlSW5kZXgpOwoJCQkJCWNvb3JkcyA9IHRoaXMuZmFjZUluZGV4VG9Db29yZGluYXRlcyhmYWNlSW5kZXgpOwoJCQkJfQoJCQkJdGhpcy4kZW1pdCgiY2xpY2tFdmVudCIsIHRoaXMuZ3JpZFtjb29yZHMucm93XVtjb29yZHMuY29sXSk7CgkJCX0KCQl9LAoKCQlkZWdyZWVzVG9SYWRpYW5zKGRlZ3JlZXMpIHsKCQkJcmV0dXJuIGRlZ3JlZXMgKiBNYXRoLlBJLzE4MDsKCQl9LAoKCQlmYWNlSW5kZXhUb0Nvb3JkaW5hdGVzKGZhY2VJbmRleCkgewoJCQkvLyBBcyBlYWNoIG5vZGUgaGFzIDIgZmFjZXMKCQkJcmV0dXJuIHsKCQkJCXJvdzogTWF0aC5mbG9vcihmYWNlSW5kZXggLyAyIC8gdGhpcy5yb3dzKSwKCQkJCWNvbDogTWF0aC5mbG9vcigoZmFjZUluZGV4IC8gMikgJSB0aGlzLmNvbHMpLAoJCQl9OwoJCX0sCgoJCWNsZWFyRm9jdXMoKSB7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImhlYWRlciIpWzBdLmNsaWNrKCk7CgkJfSwKCgkJb25LZXlEb3duKGV2ZW50KSB7CgkJCWlmICh0aGlzLmNvbnRyb2xUeXBlID09ICJPcmJpdCIpIHsKCQkJCXN3aXRjaCAoZXZlbnQua2V5Q29kZSkgewoJCQkJCS8vIGNhc2UgNzI6ICAvLyBoCgkJCQkJLy8gCXRoaXMuaGVtaXNwaGVyZUxpZ2h0LnZpc2libGUgPSAhdGhpcy5oZW1pc3BoZXJlTGlnaHQudmlzaWJsZTsKCQkJCQkvLyAJYnJlYWs7CgkJCQkJLy8gY2FzZSA2ODogLy8gZAoJCQkJCS8vIAl0aGlzLmRpcmVjdGlvbmFsTGlnaHQudmlzaWJsZSA9ICF0aGlzLmRpcmVjdGlvbmFsTGlnaHQudmlzaWJsZTsKCQkJCQkvLyAJYnJlYWs7CgkJCQkJY2FzZSA4NzogLy8gdwoJCQkJCQl0aGlzLiRlbWl0KCdzd2l0Y2hXb3JsZFNldHVwJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgODA6IC8vIHAKCQkJCQkJdGhpcy4kZW1pdCgnc3dpdGNoQ29udHJvbFR5cGUnKTsKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsKCQkJCQljYXNlIDM4OiAvLyB1cAoJCQkJCWNhc2UgODc6IC8vIHcKCQkJCQkJdGhpcy5wb2ludGVyTG9jay5tb3ZlRm9yd2FyZCA9IHRydWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgMzc6IC8vIGxlZnQKCQkJCQljYXNlIDY1OiAvLyBhCgkJCQkJCXRoaXMucG9pbnRlckxvY2subW92ZUxlZnQgPSB0cnVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlIDQwOiAvLyBkb3duCgkJCQkJY2FzZSA4MzogLy8gcwoJCQkJCQl0aGlzLnBvaW50ZXJMb2NrLm1vdmVCYWNrd2FyZCA9IHRydWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgMzk6IC8vIHJpZ2h0CgkJCQkJY2FzZSA2ODogLy8gZAoJCQkJCQl0aGlzLnBvaW50ZXJMb2NrLm1vdmVSaWdodCA9IHRydWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgMzI6IC8vIHNwYWNlCgkJCQkJCWlmICh0aGlzLnBvaW50ZXJMb2NrLmNhbkp1bXAgPT09IHRydWUpIHRoaXMucG9pbnRlckxvY2sudmVsb2NpdHkueSArPSAyMDA7CgkJCQkJCXRoaXMucG9pbnRlckxvY2suY2FuSnVtcCA9IGZhbHNlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlIDgwOiAvLyBQCgkJCQkJCWlmKCF0aGlzLmNvbnRyb2xzLmlzTG9ja2VkKSB7CgkJCQkJCQl0aGlzLiRlbWl0KCdzd2l0Y2hDb250cm9sVHlwZScpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfSwKCgkJb25LZXlVcChldmVudCkgewoJCQlzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsKCQkJCWNhc2UgMzg6IC8vIHVwCgkJCQljYXNlIDg3OiAvLyB3CgkJCQkJdGhpcy5wb2ludGVyTG9jay5tb3ZlRm9yd2FyZCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAzNzogLy8gbGVmdAoJCQkJY2FzZSA2NTogLy8gYQoJCQkJCXRoaXMucG9pbnRlckxvY2subW92ZUxlZnQgPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWNhc2UgNDA6IC8vIGRvd24KCQkJCWNhc2UgODM6IC8vIHMKCQkJCQl0aGlzLnBvaW50ZXJMb2NrLm1vdmVCYWNrd2FyZCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAzOTogLy8gcmlnaHQKCQkJCWNhc2UgNjg6IC8vIGQKCQkJCQl0aGlzLnBvaW50ZXJMb2NrLm1vdmVSaWdodCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQl9CgkJfSwKCX0sCn07Cg=="},{"version":3,"sources":["VisualizerCanvas.vue"],"names":[],"mappings":";AA4BA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VisualizerCanvas.vue","sourceRoot":"src/components","sourcesContent":["<template>\n\t<div id=\"visualizer\" @click=\"controlType == 'PointerLock' ? controls.lock() : clearFocus\">\n\t\t<script type=\"x-shader/x-vertex\" id=\"vertexShader\">\n\t\t\tvarying vec3 vWorldPosition;\n\n\t\t\tvoid main() {\n\t\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\t\tvWorldPosition = worldPosition.xyz;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}\n\t\t</script>\n\t\t<script type=\"x-shader/x-fragment\" id=\"fragmentShader\">\n\t\t\tuniform vec3 topColor;\n\t\t\tuniform vec3 bottomColor;\n\t\t\tuniform float offset;\n\t\t\tuniform float exponent;\n\n\t\t\tvarying vec3 vWorldPosition;\n\n\t\t\tvoid main() {\n\t\t\t\tfloat h = normalize( vWorldPosition + offset ).y;\n\t\t\t\tgl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );\n\t\t\t}\n\t\t</script>\n\t</div>\n</template>\n\n<script>\nimport * as THREE from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls.js\";\nimport { PointerLockControls } from \"three/examples/jsm/controls/PointerLockControls.js\";\nimport TWEEN, { removeAll } from \"@tweenjs/tween.js\";\nimport Stats from \"three/examples/jsm/libs/stats.module.js\";\n\nimport { getAllNodes, tweenToColor } from \"./algorithms/helpers.js\";\n\nexport default {\n\tprops: [\n\t\t\"nodeDimensions\",\n\t\t\"grid\",\n\t\t\"rows\",\n\t\t\"cols\",\n\t\t\"start\",\n\t\t\"finish\",\n\t\t\"visualizerState\",\n\t\t\"colors\",\n\t\t\"controlType\",\n\t\t\"worldSetup\",\n\t\t\"selectedAlgorithm\",\n\t\t\"streaming\",\n\t\t\"thresholdValue\"\n\t],\n\tdata: () => ({\n\t\tscene: null,\n\t\tcamera: null,\n\t\tcameraY: 0,\n\t\tdefaultCameraY: 250,\n\t\trenderer: null,\n\t\tpointerLock: {\n\t\t\tmoveForward: false,\n\t\t\tmoveBackward: false,\n\t\t\tmoveLeft: false,\n\t\t\tmoveRight: false,\n\t\t\tvelocity: null,\n\t\t\tdirection: null,\n\t\t\tprevTime: null,\n\t\t},\n\t\tcontrols: null,\n\t\torbitControls: null,\n\t\tpointerLockControls: null,\n\t\traycaster: null,\n\t\tambientLight: null,\n\t\themisphereLight: null,\n\t\tdirectionalLight: null,\n\t\tground: null,\n\t\twallGeomtery: null,\n\t\twallMaterials: [],\n\t\twalls: {},\n\t\twallTextures: [\n\t\t\t{\n\t\t\t\tpath: \"building1.png\",\n\t\t\t\trepeatY: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \"building2.png\",\n\t\t\t\trepeatY: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \"building3.png\",\n\t\t\t\trepeatY: 3,\n\t\t\t},\n\t\t],\n\t\tdown: false,\n\t\tmoved: false,\n\t\tcurrentEvent: null,\n\t\tmouse: null,\n\t\tintersectedNode: null,\n\t\tclock: null,\n\t\tstats: null,\n\t\t// Device cam\n\t\tvideoCanvas: null,\n\t\tvideo: null\n\t}),\n\tcomputed: {\n\t\tclickableObjects() {\n\t\t\tlet objects = [];\n\t\t\tobjects.push(this.ground);\n\t\t\tfor (let id of Object.keys(this.walls)) {\n\t\t\t\tif (this.walls[id].visible) {\n\t\t\t\t\tobjects.push(this.walls[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn objects;\n\t\t},\n\t\tcollidableObjects() {\n\t\t\tlet objects = [];\n\t\t\tfor (let id of Object.keys(this.walls)) {\n\t\t\t\tif (this.walls[id].visible) {\n\t\t\t\t\tobjects.push(this.walls[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn objects;\n\t\t}\n\t},\n\twatch: {\n\t\tcontrolType: function(newVal, oldVal) {\n\t\t\tthis.setControls();\n\t\t},\n\t\tworldSetup: function(newVal, oldVal) {\n\t\t\tif (newVal) {\n\t\t\t\tTWEEN.removeAll();\n\t\t\t\tnew TWEEN.Tween(this.camera.position)\n\t\t\t\t\t.to({ x: 0, y: this.cameraY - 30, z: 0 }, 500)\n\t\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t\t.onUpdate(() => {\n\t\t\t\t\t\tthis.camera.lookAt(this.scene.position);\n\t\t\t\t\t})\n\t\t\t\t\t.onComplete(() => {\n\t\t\t\t\t\tthis.controls.enableRotate = false;\n\t\t\t\t\t\tlet lookDirection = new THREE.Vector3();\n\t\t\t\t\t\tthis.camera.getWorldDirection(lookDirection);\n\t\t\t\t\t\tthis.controls.target\n\t\t\t\t\t\t\t.copy(this.camera.position)\n\t\t\t\t\t\t\t.add(lookDirection.multiplyScalar(this.cameraY - 30));\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t\tnew TWEEN.Tween(this.camera.rotation)\n\t\t\t\t\t.to({ y: 0, z: 0 }, 500)\n\t\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t\t.start();\n\t\t\t} else {\n\t\t\t\tnew TWEEN.Tween(this.camera.position)\n\t\t\t\t\t.to({ y: this.cameraY }, 500)\n\t\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t\t.onComplete(() => {\n\t\t\t\t\t\tthis.controls.enableRotate = true;\n\t\t\t\t\t\tthis.controls.update();\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t}\n\t\t},\n\t\tstreaming: function(newVal, oldVal) {\n\t\t\tif(!newVal) {\n\t\t\t\tfor(let i=0; i<this.rows; i++) {\n\t\t\t\t\tfor(let j=0; j<this.cols; j++) {\n\t\t\t\t\t\tthis.updateNode(this.grid[i][j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tcreated() {\n\t\tthis.cameraY = this.defaultCameraY;\n\t},\n\tmounted() {\n\t\tthis.init();\n\t\t\n\t\tthis.videoCanvas = document.querySelector('#video-canvas');\n\t\tthis.video = document.querySelector('video');\n\t},\n\tmethods: {\n\t\tinit() {\n\t\t\tlet width = window.innerWidth,\n\t\t\t\theight = window.innerHeight;\n\n\t\t\t//Scene\n\t\t\tthis.scene = new THREE.Scene();\n\t\t\tthis.scene.background = new THREE.Color(0xbbd6ff);\n\t\t\tthis.scene.fog = new THREE.Fog(0xffffff, 0, 750);\n\n\t\t\t//Camera\n\t\t\tthis.camera = new THREE.PerspectiveCamera(60, width / height, 1, 5000);\n\t\t\tthis.camera.position.y = this.cameraY + 2000;\n\t\t\tthis.camera.position.x = -500;\n\t\t\tthis.camera.position.z = 500;\n\t\t\t// var helper = new THREE.CameraHelper(this.camera);\n\t\t\t// this.scene.add(helper);\n\n\t\t\t//Renderer\n\t\t\tthis.renderer = new THREE.WebGLRenderer({ antialias: true });\n\t\t\tthis.renderer.setSize(width, height);\n\t\t\tthis.renderer.shadowMap.enabled = true;\n\t\t\t// this.renderer.shadowMap.type = THREE.BasicShadowMap;\n\t\t\tdocument.getElementById(\"visualizer\").appendChild(this.renderer.domElement);\n\n\t\t\t// Controls\n\t\t\tthis.addControls();\n\t\t\tthis.setControls(true);\n\n\t\t\t// Raycaster\n\t\t\tthis.raycaster = new THREE.Raycaster();\n\n\t\t\t// Ground\n\t\t\tlet gridWidth = this.cols * this.nodeDimensions.width,\n\t\t\t\tgridHeight = this.rows * this.nodeDimensions.height;\n\t\t\tlet vm = this;\n\t\t\tlet groundGeometry = new THREE.PlaneGeometry(gridWidth, gridHeight, this.cols, this.rows);\n\t\t\tgroundGeometry.rotateX(-Math.PI / 2);\n\t\t\tlet loader = new THREE.TextureLoader();\n\t\t\tloader.load(\n\t\t\t\trequire(\"@/assets/textures/ground.png\"),\n\t\t\t\tfunction(texture) {\n\t\t\t\t\ttexture.wrapS = THREE.RepeatWrapping;\n\t\t\t\t\ttexture.wrapT = THREE.RepeatWrapping;\n\t\t\t\t\ttexture.repeat.x = vm.rows;\n\t\t\t\t\ttexture.repeat.y = vm.cols;\n\t\t\t\t\tvar groundMaterial = new THREE.MeshLambertMaterial({\n\t\t\t\t\t\tmap: texture,\n\t\t\t\t\t\tside: THREE.FrontSide,\n\t\t\t\t\t\tvertexColors: THREE.FaceColors,\n\t\t\t\t\t});\n\t\t\t\t\tvm.ground = new THREE.Mesh(groundGeometry, groundMaterial);\n\t\t\t\t\tvm.ground.receiveShadow = true;\n\t\t\t\t\tvm.ground.position.y = 0.02;\n\t\t\t\t\tvm.scene.add(vm.ground);\n\t\t\t\t\tvm.initGrid();\n\t\t\t\t\tvm.$emit(\"groundInitialized\", vm.ground);\n\t\t\t\t},\n\t\t\t\tundefined,\n\t\t\t\tfunction(error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\t\t\t);\n\t\t\tlet fakeGroundGeometry = new THREE.PlaneGeometry(1000, 1000, this.cols, this.rows);\n\t\t\tfakeGroundGeometry.rotateX(-Math.PI / 2);\n\t\t\tvar fakeGroundMaterial = new THREE.MeshLambertMaterial({\n\t\t\t\t// color: 0x87775d,\n\t\t\t\tcolor: 0xBBC2D0,\n\t\t\t\tside: THREE.FrontSide,\n\t\t\t});\n\t\t\tlet fakeGround = new THREE.Mesh(fakeGroundGeometry, fakeGroundMaterial);\n\t\t\tthis.scene.add(fakeGround);\n\n\t\t\t//Grid helper\n\t\t\tvar size = this.cols * this.nodeDimensions.height;\n\t\t\tvar divisions = this.cols;\n\t\t\tvar gridHelper = new THREE.GridHelper(size, divisions, 0x5c78bd, 0x5c78bd);\n\t\t\tgridHelper.position.y = 0.035;\n\t\t\tthis.scene.add(gridHelper);\n\n\t\t\t// Wall\n\t\t\t// let wallHeight = this.nodeDimensions.width * 2 + Math.random() * this.nodeDimensions.width * 3;\n\t\t\tlet wallHeight = this.nodeDimensions.height * 2;\n\t\t\tthis.wallGeomtery = new THREE.BoxBufferGeometry(\n\t\t\t\tthis.nodeDimensions.width,\n\t\t\t\twallHeight,\n\t\t\t\tthis.nodeDimensions.height\n\t\t\t);\n\t\t\tlet wallTextureObject = this.wallTextures[\n\t\t\t\tMath.floor(Math.random() * this.wallTextures.length)\n\t\t\t];\n\t\t\tthis.wallMaterials.push(\n\t\t\t\tnew THREE.MeshPhongMaterial({\n\t\t\t\t\tcolor: new THREE.Color(this.colors.wall.r, this.colors.wall.g, this.colors.wall.b),\n\t\t\t\t})\n\t\t\t);\n\t\t\tfor (let tex of this.wallTextures) {\n\t\t\t\tloader.load(\n\t\t\t\t\trequire(\"@/assets/textures/\" + tex.path),\n\t\t\t\t\tfunction(texture) {\n\t\t\t\t\t\ttexture.wrapT = THREE.RepeatWrapping;\n\t\t\t\t\t\ttexture.repeat.y = tex.repeatY;\n\t\t\t\t\t\tvm.wallMaterials.push(new THREE.MeshLambertMaterial({ map: texture }));\n\t\t\t\t\t},\n\t\t\t\t\tundefined,\n\t\t\t\t\tfunction(error) {\n\t\t\t\t\t\tconsole.log(error);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Ambient Light\n\t\t\tthis.ambientLight = new THREE.AmbientLight(0xffffff, 1);\n\t\t\tthis.scene.add(this.ambientLight);\n\n\t\t\t// LIGHTS\n\t\t\tthis.hemisphereLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.1);\n\t\t\tthis.hemisphereLight.color.setHSL(0.6, 1, 0.6);\n\t\t\tthis.hemisphereLight.groundColor.setHex(0x87775d);\n\t\t\tthis.hemisphereLight.position.set(0, 5, 0);\n\t\t\tthis.scene.add(this.hemisphereLight);\n\n\t\t\t// let hemiLightHelper = new THREE.HemisphereLightHelper(this.hemisphereLight, 10);\n\t\t\t// this.scene.add(hemiLightHelper);\n\n\t\t\tthis.directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\n\t\t\tthis.directionalLight.color.setHSL(0.1, 1, 0.95);\n\t\t\tthis.directionalLight.position.set(-1, 1.75, 1);\n\t\t\tthis.directionalLight.position.multiplyScalar(70);\n\t\t\tthis.scene.add(this.directionalLight);\n\n\t\t\tthis.directionalLight.castShadow = true;\n\t\t\tthis.directionalLight.shadow.mapSize.width = 2048;\n\t\t\tthis.directionalLight.shadow.mapSize.height = 2048;\n\n\t\t\tvar d = 200;\n\t\t\tthis.directionalLight.shadow.camera.left = -d;\n\t\t\tthis.directionalLight.shadow.camera.right = d;\n\t\t\tthis.directionalLight.shadow.camera.top = d;\n\t\t\tthis.directionalLight.shadow.camera.bottom = -d;\n\t\t\tthis.directionalLight.shadow.camera.far = 350;\n\n\t\t\t// SKYDOME\n\t\t\tvar vertexShader = document.getElementById(\"vertexShader\").textContent;\n\t\t\tvar fragmentShader = document.getElementById(\"fragmentShader\").textContent;\n\t\t\tvar uniforms = {\n\t\t\t\ttopColor: { value: new THREE.Color(0x0077ff) },\n\t\t\t\tbottomColor: { value: new THREE.Color(0xffffff) },\n\t\t\t\toffset: { value: 33 },\n\t\t\t\texponent: { value: 0.6 },\n\t\t\t};\n\t\t\tuniforms[\"topColor\"].value.copy(this.hemisphereLight.color);\n\n\t\t\tthis.scene.fog.color.copy(uniforms[\"bottomColor\"].value);\n\t\t\tvar skyGeo = new THREE.SphereBufferGeometry(1000, 32, 15);\n\t\t\tvar skyMat = new THREE.ShaderMaterial({\n\t\t\t\tuniforms: uniforms,\n\t\t\t\tvertexShader: vertexShader,\n\t\t\t\tfragmentShader: fragmentShader,\n\t\t\t\tside: THREE.BackSide,\n\t\t\t});\n\t\t\tvar sky = new THREE.Mesh(skyGeo, skyMat);\n\t\t\tthis.scene.add(sky);\n\n\t\t\t// Stats\n\t\t\tthis.stats = new Stats();\n\t\t\tthis.stats.dom.style.top = \"auto\";\n\t\t\tthis.stats.dom.style.bottom = '5px';\n\t\t\tthis.stats.dom.style.left = '3px';\n\t\t\tdocument.getElementById(\"visualizer\").appendChild(this.stats.dom);\n\n\t\t\t//Resize handler\n\t\t\twindow.addEventListener(\"resize\", this.resizeHandler);\n\t\t\tthis.renderer.domElement.addEventListener(\"mousedown\", this.onMouseDown, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"touchstart\", this.onMouseDown, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"mousemove\", this.onMouseMove, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"touchmove\", this.onMouseMove, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"mouseup\", this.onMouseup, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"mouseleave\", this.onMouseLeave, true);\n\t\t\tthis.renderer.domElement.addEventListener(\"touchend\", this.onMouseup, true);\n\n\t\t\t// Setting hover handler\n\t\t\tthis.mouse = new THREE.Vector2();\n\n\t\t\tthis.renderLoop();\n\t\t},\n\n\t\trenderLoop() {\n\t\t\trequestAnimationFrame(this.renderLoop);\n\t\t\tif (this.controlType == \"PointerLock\") {\n\t\t\t\tvar delta = this.clock.getDelta();\n\t\t\t\tthis.animatePlayer(delta);\n\t\t\t}\n\t\t\tif (this.worldSetup) {\n\t\t\t\tthis.hoverObjectLoop();\n\t\t\t\tif(this.streaming) {\n\t\t\t\t\tthis.deviceCamLoop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.renderer.render(this.scene, this.camera);\n\t\t\tTWEEN.update();\n\t\t\tthis.stats.update();\n\t\t},\n\n\t\thoverObjectLoop() {\n\t\t\tif (!this.down) {\n\t\t\t\tthis.intersectedNode = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.raycaster.setFromCamera(this.mouse, this.camera);\n\t\t\tvar intersects = this.raycaster.intersectObjects(this.clickableObjects);\n\t\t\tif (intersects.length > 0) {\n\t\t\t\tlet coords;\n\t\t\t\tif (intersects[0].object.name == \"wall\") {\n\t\t\t\t\tcoords = this.faceIndexToCoordinates(intersects[0].object.wallId * 2);\n\t\t\t\t} else {\n\t\t\t\t\tvar faceIndex = intersects[0].faceIndex;\n\t\t\t\t\tcoords = this.faceIndexToCoordinates(faceIndex);\n\t\t\t\t}\n\n\t\t\t\tif (this.grid[coords.row][coords.col] != this.intersectedNode) {\n\t\t\t\t\tlet ends = [\"start\", \"finish\"];\n\t\t\t\t\tif (\n\t\t\t\t\t\tends.includes(this.grid[coords.row][coords.col].status) ||\n\t\t\t\t\t\t(this.intersectedNode && ends.includes(this.intersectedNode.status))\n\t\t\t\t\t) {\n\t\t\t\t\t\tlet end;\n\t\t\t\t\t\tif (ends.includes(this.grid[coords.row][coords.col].status)) {\n\t\t\t\t\t\t\tend = this.grid[coords.row][coords.col].status;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tend = this.intersectedNode.status;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet obj = {};\n\t\t\t\t\t\tobj[end] = {\n\t\t\t\t\t\t\trow: coords.row,\n\t\t\t\t\t\t\tcol: coords.col,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (this.intersectedNode && ends.includes(this.intersectedNode.status)) {\n\t\t\t\t\t\t\tthis.intersectedNode.status = \"default\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.grid[coords.row][coords.col].status = end;\n\t\t\t\t\t\tthis.$emit(\"updateEnds\", obj);\n\t\t\t\t\t} else if (this.selectedAlgorithm.type != 'unweighted' && (!this.intersectedNode || !ends.includes(this.intersectedNode.status))) {\n\t\t\t\t\t\tthis.grid[coords.row][coords.col].status =\n\t\t\t\t\t\t\tthis.grid[coords.row][coords.col].status == \"wall\" ? \"default\" : \"wall\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.intersectedNode = this.grid[coords.row][coords.col];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tanimatePlayer(delta) {\n\t\t\tlet playerSpeed = 300;\n\t\t\t// Gradual slowdown\n\t\t\tthis.pointerLock.velocity.x -= this.pointerLock.velocity.x * 10.0 * delta;\n\t\t\tthis.pointerLock.velocity.z -= this.pointerLock.velocity.z * 10.0 * delta;\n\n\t\t\tif (this.detectPlayerCollision() == false) {\n\t\t\t\tthis.pointerLock.direction.z =\n\t\t\t\t\tNumber(this.pointerLock.moveForward) - Number(this.pointerLock.moveBackward);\n\t\t\t\tthis.pointerLock.direction.x =\n\t\t\t\t\tNumber(this.pointerLock.moveRight) - Number(this.pointerLock.moveLeft);\n\t\t\t\tthis.pointerLock.direction.normalize(); // this ensures consistent movements in all directions\n\t\n\t\t\t\tif (this.pointerLock.moveForward || this.pointerLock.moveBackward)\n\t\t\t\t\tthis.pointerLock.velocity.z -= this.pointerLock.direction.z * playerSpeed * delta;\n\t\t\t\tif (this.pointerLock.moveLeft || this.pointerLock.moveRight)\n\t\t\t\t\tthis.pointerLock.velocity.x -= this.pointerLock.direction.x * playerSpeed * delta;\n\t\n\t\t\t\tthis.controls.moveRight(-this.pointerLock.velocity.x * delta);\n\t\t\t\tthis.controls.moveForward(-this.pointerLock.velocity.z * delta);\n\t\t\t} else {\n\t\t\t\tthis.pointerLock.velocity.x = 0;\n\t\t\t\tthis.pointerLock.velocity.z = 0;\n\t\t\t}\n\n\t\t\tthis.pointerLock.velocity.y -= 9.8 * 50.0 * delta; // 50.0 = mass\n\t\t\tif(this.detectOnObject()) {\n\t\t\t\tthis.pointerLock.velocity.y = Math.max(0, this.pointerLock.velocity.y);\n\t\t\t\tthis.pointerLock.canJump = true;\n\t\t\t}\n\t\t\tthis.controls.getObject().position.y += this.pointerLock.velocity.y * delta;\n\n\t\t\tif (this.controls.getObject().position.y < this.cameraY) {\n\t\t\t\tthis.pointerLock.velocity.y = 0;\n\t\t\t\tthis.controls.getObject().position.y = this.cameraY;\n\t\t\t\tthis.pointerLock.canJump = true;\n\t\t\t}\n\t\t},\n\n\t\tdetectPlayerCollision() {\n\t\t\tlet rotationMatrix;\n\t\t\t// Get direction of camera\n\t\t\tlet cameraDirection = this.controls.getDirection(new THREE.Vector3(0, 0, 0)).clone();\n\t\t\tlet collisionDistance = 1;\n\n\t\t\t// Check which direction we're moving (not looking)\n\t\t\t// Flip matrix to that direction so that we can reposition the ray\n\t\t\tif (this.pointerLock.moveBackward) {\n\t\t\t\trotationMatrix = new THREE.Matrix4();\n\t\t\t\trotationMatrix.makeRotationY(this.degreesToRadians(180));\n\t\t\t} else if (this.pointerLock.moveLeft) {\n\t\t\t\trotationMatrix = new THREE.Matrix4();\n\t\t\t\trotationMatrix.makeRotationY(this.degreesToRadians(90));\n\t\t\t} else if (this.pointerLock.moveRight) {\n\t\t\t\trotationMatrix = new THREE.Matrix4();\n\t\t\t\trotationMatrix.makeRotationY(this.degreesToRadians(270));\n\t\t\t}\n\n\t\t\t// Player is not moving forward, apply rotation matrix needed\n\t\t\tif (rotationMatrix !== undefined) {\n\t\t\t\tcameraDirection.applyMatrix4(rotationMatrix);\n\t\t\t}\n\n\t\t\t// Apply ray to player camera\n\t\t\tlet rayCaster = new THREE.Raycaster(this.controls.getObject().position, cameraDirection);\n\n\t\t\t// If our ray hit a collidable object, return true\n\t\t\tif (this.rayIntersect(rayCaster, collisionDistance)) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\tdetectOnObject() {\n\t\t\tlet collisionDistance = this.cameraY+1;\n\t\t\tlet rayCaster = new THREE.Raycaster(this.controls.getObject().position, new THREE.Vector3(0, -1, 0));\n\t\t\t// rayCaster.ray.origin.y -= this.cameraY;\n\t\t\tif (this.rayIntersect(rayCaster, collisionDistance)) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\tdeviceCamLoop() {\n\t\t\tlet videoCtx = this.videoCanvas.getContext(\"2d\");\n\n\t\t\tvideoCtx.drawImage(this.video, 0, 0, this.videoCanvas.width, this.videoCanvas.height);\n\t\t\tlet pixels = videoCtx.getImageData(0, 0, this.videoCanvas.width, this.videoCanvas.height);\n\t\t\tfor(let y=0; y<this.videoCanvas.height; y++) {\n\t\t\t\tfor(let x=0; x<this.videoCanvas.width; x++) {\n\t\t\t\t\tlet index = (x + y * this.videoCanvas.width) * 4;\n\t\t\t\t\tlet r = pixels.data[index+0];\n\t\t\t\t\tlet g = pixels.data[index+1];\n\t\t\t\t\tlet b = pixels.data[index+2];\n\t\t\t\t\t\n\t\t\t\t\tlet brightness = Math.floor((r+g+b)/3);\n\t\t\t\t\tlet gridX = Math.floor(this.videoCanvas.width-1-x);\n\t\t\t\t\tlet status = \"default\";\n\t\t\t\t\tif (y == this.start.row && gridX == this.start.col) {\n\t\t\t\t\t\tstatus = \"start\";\n\t\t\t\t\t} else if (y == this.finish.row && gridX == this.finish.col) {\n\t\t\t\t\t\tstatus = \"finish\";\n\t\t\t\t\t}\n\t\t\t\t\tif(brightness > this.thresholdValue) {\n\t\t\t\t\t\tthis.grid[y][gridX].status = status;\n\t\t\t\t\t} else if(status != 'start' && status != 'finish') {\n\t\t\t\t\t\tthis.grid[y][gridX].status = 'wall';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\trayIntersect(ray, distance) {\n\t\t\tvar intersects = ray.intersectObjects(this.collidableObjects);\n\t\t\tfor (var i = 0; i < intersects.length; i++) {\n\t\t\t\t// Check if there's a collision\n\t\t\t\tif (intersects[i].distance < distance) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\taddControls() {\n\t\t\tthis.orbitControls = new OrbitControls(this.camera, this.renderer.domElement);\n\t\t\tthis.pointerLockControls = new PointerLockControls(this.camera, this.renderer.domElement);\n\t\t\tthis.pointerLockControls.addEventListener(\"lock\", function() {\n\t\t\t\tconsole.log(\"Pointer Locked\");\n\t\t\t});\n\t\t\tthis.pointerLockControls.addEventListener(\"unlock\", function() {\n\t\t\t\tconsole.log(\"Pointer Unlocked\");\n\t\t\t});\n\t\t\t// Clock\n\t\t\tthis.clock = new THREE.Clock();\n\t\t\tdocument.addEventListener(\"keydown\", this.onKeyDown, false);\n\t\t\tdocument.addEventListener(\"keyup\", this.onKeyUp, false);\n\t\t\tthis.pointerLock.velocity = new THREE.Vector3();\n\t\t\tthis.pointerLock.direction = new THREE.Vector3();\n\t\t\tthis.scene.add(this.pointerLockControls.getObject());\n\t\t},\n\n\t\tsetControls(fromInit = false) {\n\t\t\tlet vm = this;\n\t\t\tTWEEN.removeAll();\n\t\t\tif (this.controlType == \"Orbit\") {\n\t\t\t\t// OrbitControls\n\t\t\t\tthis.cameraY = this.defaultCameraY;\n\t\t\t\tthis.camera.near = 1;\n\t\t\t\tthis.camera.updateProjectionMatrix();\n\t\t\t\tthis.controls = this.orbitControls;\n\t\t\t\tthis.controls.enabled = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tvm.resetCamera();\n\t\t\t\t}, fromInit ? 800 : 0);\n\t\t\t} else if (this.controlType == \"PointerLock\") {\n\t\t\t\t// PointerLock controls\n\t\t\t\tthis.cameraY = 3;\n\t\t\t\tthis.camera.near = 0.05;\n\t\t\t\tthis.camera.updateProjectionMatrix();\n\t\t\t\tthis.controls.enabled = false;\n\t\t\t\tthis.controls = this.pointerLockControls;\n\t\t\t\tlet startPosition = this.ground.geometry.vertices[\n\t\t\t\t\tthis.grid[this.start.row][this.start.col].faces[1][\"a\"]\n\t\t\t\t];\n\t\t\t\tnew TWEEN.Tween(this.camera.position)\n\t\t\t\t\t.to(startPosition, 2000)\n\t\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t\t.start();\n\t\t\t\tnew TWEEN.Tween(this.camera.rotation)\n\t\t\t\t\t.to({ x: 0, y: (5 * Math.PI) / 4, z: 0 }, 2000)\n\t\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t\t.start();\n\t\t\t}\n\t\t},\n\n\t\tresetCamera() {\n\t\t\tnew TWEEN.Tween(this.camera.position)\n\t\t\t\t.to({ x: 0, y: this.cameraY, z: 0 }, 2000)\n\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t.onUpdate(() => {\n\t\t\t\t\tthis.camera.lookAt(this.scene.position);\n\t\t\t\t})\n\t\t\t\t.onComplete(() => {\n\t\t\t\t\tlet lookDirection = new THREE.Vector3();\n\t\t\t\t\tthis.camera.getWorldDirection(lookDirection);\n\t\t\t\t\tthis.controls.target\n\t\t\t\t\t\t.copy(this.camera.position)\n\t\t\t\t\t\t.add(lookDirection.multiplyScalar(this.cameraY));\n\t\t\t\t})\n\t\t\t\t.start();\n\t\t\tnew TWEEN.Tween(this.camera.rotation)\n\t\t\t\t.to({ x: -Math.PI / 2, y: 0, z: 0 }, 2000)\n\t\t\t\t.easing(TWEEN.Easing.Exponential.Out)\n\t\t\t\t.start();\n\t\t},\n\n\t\tresizeHandler(event) {\n\t\t\tlet width = window.innerWidth,\n\t\t\t\theight = window.innerHeight;\n\t\t\tthis.renderer.setSize(width, height);\n\t\t\tthis.camera.aspect = width / height;\n\t\t\tthis.camera.updateProjectionMatrix();\n\t\t},\n\n\t\tinitGrid() {\n\t\t\tlet vm = this;\n\t\t\tfor (let i = 0; i < this.rows; i++) {\n\t\t\t\tlet currentRow = [];\n\t\t\t\tfor (let j = 0; j < this.cols; j++) {\n\t\t\t\t\tlet node = this.createNode(i, j);\n\t\t\t\t\tcurrentRow.push(node);\n\t\t\t\t}\n\t\t\t\tthis.grid.push(currentRow);\n\t\t\t}\n\t\t\tfor (let i = 0; i < this.rows; i++) {\n\t\t\t\tfor (let j = 0; j < this.cols; j++) {\n\t\t\t\t\tthis.$watch(\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\treturn this.grid[i][j];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.nodeWatcher,\n\t\t\t\t\t\t{ deep: true }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcreateNode(row, col) {\n\t\t\tlet faces = {};\n\t\t\tlet faceIndex = row * 2 * this.cols + col * 2;\n\t\t\tfaces[1] = this.ground.geometry.faces[faceIndex];\n\t\t\tfaceIndex = faceIndex % 2 == 0 ? faceIndex + 1 : faceIndex - 1;\n\t\t\tfaces[2] = this.ground.geometry.faces[faceIndex];\n\n\t\t\tlet status = \"default\";\n\t\t\tif (row == this.start.row && col == this.start.col) {\n\t\t\t\tstatus = \"start\";\n\t\t\t} else if (row == this.finish.row && col == this.finish.col) {\n\t\t\t\tstatus = \"finish\";\n\t\t\t}\n\n\t\t\t// Node info\n\t\t\tlet node = {\n\t\t\t\tid: row * this.cols + col,\n\t\t\t\trow: row,\n\t\t\t\tcol: col,\n\t\t\t\tfaces: faces,\n\t\t\t\tstatus: status,\n\t\t\t\tdistance: Infinity,\n\t\t\t\ttotalDistance: Infinity,\n\t\t\t\theuristicDistance: null,\n\t\t\t\tdirection: null,\n\t\t\t\tweight: 0,\n\t\t\t\tpreviousNode: null,\n\t\t\t};\n\n\t\t\tif (status == \"start\") {\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.start]);\n\t\t\t} else if (status == \"finish\") {\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.finish]);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\tnodeWatcher(newVal, oldVal) {\n\t\t\t// console.log('WATCHER', newVal);\n\t\t\tif (this.visualizerState == \"running\") return;\n\t\t\tthis.updateNode(newVal, this.streaming);\n\t\t},\n\n\t\tupdateNode(node, instant = false) {\n\t\t\tif (node.status == \"wall\") {\n\t\t\t\tlet scaleY = 0.5 + Math.random();\n\t\t\t\tif(!instant) {\n\t\t\t\t\tthis.addWall(node, scaleY, instant ? 0 : 1000);\n\t\t\t\t}\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.wall]);\n\t\t\t} else if (node.status == \"start\") {\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.start]);\n\t\t\t} else if (node.status == \"finish\") {\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.finish]);\n\t\t\t} else if (node.status == \"visited\") {\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.visited]);\n\t\t\t} else {\n\t\t\t\tif (this.walls[node.id] != null && this.walls[node.id].visible && !instant) {\n\t\t\t\t\tthis.hideWall(this.walls[node.id]);\n\t\t\t\t}\n\t\t\t\ttweenToColor(node, this.ground.geometry, [this.colors.default]);\n\t\t\t}\n\t\t},\n\n\t\taddWall(node, scaleY, duration) {\n\t\t\tif (!!this.walls[node.id]) {\n\t\t\t\tif(!this.walls[node.id].visible) {\n\t\t\t\t\tthis.showWall(this.walls[node.id], scaleY, duration);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet materialId = 1 + Math.floor(Math.random() * (this.wallMaterials.length - 1));\n\t\t\tlet wall = new THREE.Mesh(this.wallGeomtery, this.wallMaterials[materialId]);\n\t\t\twall.name = \"wall\";\n\t\t\twall.wallId = node.id;\n\t\t\twall.scale.y = scaleY;\n\t\t\twall.castShadow = true;\n\t\t\twall.receiveShadow = true;\n\t\t\tthis.scene.add(wall);\n\t\t\tthis.$set(this.walls, node.id, wall);\n\n\t\t\tlet gridWidth = this.cols * this.nodeDimensions.width;\n\t\t\tlet gridHeight = this.rows * this.nodeDimensions.height;\n\t\t\tlet height = this.wallGeomtery.parameters.height * wall.scale.y;\n\t\t\tlet x = -gridWidth / 2 + this.nodeDimensions.width / 2 + node.col * this.nodeDimensions.width,\n\t\t\t\ty = height / 2,\n\t\t\t\tz =\n\t\t\t\t\t-gridHeight / 2 + this.nodeDimensions.height / 2 + node.row * this.nodeDimensions.height;\n\t\t\t\n\t\t\tif(duration == 0) {\n\t\t\t\twall.position.set(x, y, z);\n\t\t\t} else {\n\t\t\t\twall.position.set(x, height, z);\n\t\t\t\tnew TWEEN.Tween(wall.position)\n\t\t\t\t\t.to({ x: x, y: y, z: z }, duration)\n\t\t\t\t\t.easing(TWEEN.Easing.Bounce.Out)\n\t\t\t\t\t.start();\n\t\t\t}\n\t\t},\n\n\t\tshowWall(wall, scaleY, duration) {\n\t\t\twall.scale.y = scaleY;\n\t\t\tlet height = wall.geometry.parameters.height * wall.scale.y;\n\t\t\twall.visible = true;\n\t\t\tif(duration == 0) {\n\t\t\t\twall.position.setY(height/2);\n\t\t\t} else {\n\t\t\t\twall.position.setY(height);\n\t\t\t\tnew TWEEN.Tween(wall.position)\n\t\t\t\t\t.to({ y: height / 2 }, duration)\n\t\t\t\t\t.easing(TWEEN.Easing.Bounce.Out)\n\t\t\t\t\t.start();\n\t\t\t}\n\t\t},\n\n\t\thideWall(wall) {\n\t\t\twall.visible = false;\n\t\t},\n\n\t\tonMouseDown(event) {\n\t\t\tthis.down = true;\n\t\t\tthis.moved = false;\n\t\t\tthis.currentEvent = event;\n\t\t\tthis.setMouseVector(event, \"move\");\n\t\t\tthis.clearFocus();\n\t\t},\n\t\tonMouseMove(event) {\n\t\t\tif (!this.down) return;\n\t\t\tthis.moved = true;\n\t\t\tif (this.worldSetup) {\n\t\t\t\tthis.setMouseVector(event, \"move\");\n\t\t\t}\n\t\t},\n\t\tonMouseLeave() {\n\t\t\tif (this.moved) {\n\t\t\t\tthis.onMouseup();\n\t\t\t}\n\t\t\tthis.down = false;\n\t\t},\n\t\tonMouseup(event) {\n\t\t\tlet threshold = 25;\n\t\t\tif (this.moved) {\n\t\t\t\tlet dist = 0;\n\t\t\t\tif (this.currentEvent.touches && this.currentEvent.touches.length > 0) {\n\t\t\t\t\tdist = this.calcDist(\n\t\t\t\t\t\tthis.currentEvent.touches[0].pageX - event.changedTouches[0].pageX,\n\t\t\t\t\t\tthis.currentEvent.touches[0].pageY - event.changedTouches[0].pageY\n\t\t\t\t\t);\n\t\t\t\t\tdist > threshold ? this.moveHandler(event) : this.clickHandler(event);\n\t\t\t\t} else {\n\t\t\t\t\tthis.moveHandler(event);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.clickHandler(event);\n\t\t\t}\n\t\t\tthis.currentEvent = null;\n\t\t\tthis.moved = false;\n\t\t\tthis.down = false;\n\t\t},\n\n\t\tcalcDist(x, y) {\n\t\t\treturn x * x + y * y;\n\t\t},\n\n\t\tsetMouseVector(event, type) {\n\t\t\tlet touchEvent = type == \"click\" ? this.currentEvent : event;\n\t\t\tif (touchEvent.touches && touchEvent.touches.length > 0) {\n\t\t\t\tthis.mouse.x = (touchEvent.touches[0].clientX / window.innerWidth) * 2 - 1;\n\t\t\t\tthis.mouse.y = -(touchEvent.touches[0].clientY / window.innerHeight) * 2 + 1;\n\t\t\t} else {\n\t\t\t\tthis.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n\t\t\t\tthis.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\t\t\t}\n\t\t},\n\n\t\tmoveHandler(event) {\n\t\t\t// console.log(\"Moved\");\n\t\t},\n\n\t\tclickHandler(event) {\n\t\t\tif (this.worldSetup || this.controlType == \"PointerLock\") return;\n\t\t\tthis.setMouseVector(event, \"click\");\n\t\t\tthis.raycaster.setFromCamera(this.mouse, this.camera);\n\t\t\tlet intersects = this.raycaster.intersectObjects(this.clickableObjects); //array\n\t\t\tif (intersects.length > 0) {\n\t\t\t\tlet coords;\n\t\t\t\tif (intersects[0].object.name == \"wall\") {\n\t\t\t\t\tcoords = this.faceIndexToCoordinates(intersects[0].object.wallId * 2);\n\t\t\t\t} else {\n\t\t\t\t\tvar faceIndex = intersects[0].faceIndex;\n\t\t\t\t\tconsole.log(faceIndex);\n\t\t\t\t\tcoords = this.faceIndexToCoordinates(faceIndex);\n\t\t\t\t}\n\t\t\t\tthis.$emit(\"clickEvent\", this.grid[coords.row][coords.col]);\n\t\t\t}\n\t\t},\n\n\t\tdegreesToRadians(degrees) {\n\t\t\treturn degrees * Math.PI/180;\n\t\t},\n\n\t\tfaceIndexToCoordinates(faceIndex) {\n\t\t\t// As each node has 2 faces\n\t\t\treturn {\n\t\t\t\trow: Math.floor(faceIndex / 2 / this.rows),\n\t\t\t\tcol: Math.floor((faceIndex / 2) % this.cols),\n\t\t\t};\n\t\t},\n\n\t\tclearFocus() {\n\t\t\tdocument.getElementsByClassName(\"header\")[0].click();\n\t\t},\n\n\t\tonKeyDown(event) {\n\t\t\tif (this.controlType == \"Orbit\") {\n\t\t\t\tswitch (event.keyCode) {\n\t\t\t\t\t// case 72:  // h\n\t\t\t\t\t// \tthis.hemisphereLight.visible = !this.hemisphereLight.visible;\n\t\t\t\t\t// \tbreak;\n\t\t\t\t\t// case 68: // d\n\t\t\t\t\t// \tthis.directionalLight.visible = !this.directionalLight.visible;\n\t\t\t\t\t// \tbreak;\n\t\t\t\t\tcase 87: // w\n\t\t\t\t\t\tthis.$emit('switchWorldSetup');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 80: // p\n\t\t\t\t\t\tthis.$emit('switchControlType');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (event.keyCode) {\n\t\t\t\t\tcase 38: // up\n\t\t\t\t\tcase 87: // w\n\t\t\t\t\t\tthis.pointerLock.moveForward = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 37: // left\n\t\t\t\t\tcase 65: // a\n\t\t\t\t\t\tthis.pointerLock.moveLeft = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 40: // down\n\t\t\t\t\tcase 83: // s\n\t\t\t\t\t\tthis.pointerLock.moveBackward = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 39: // right\n\t\t\t\t\tcase 68: // d\n\t\t\t\t\t\tthis.pointerLock.moveRight = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 32: // space\n\t\t\t\t\t\tif (this.pointerLock.canJump === true) this.pointerLock.velocity.y += 200;\n\t\t\t\t\t\tthis.pointerLock.canJump = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 80: // P\n\t\t\t\t\t\tif(!this.controls.isLocked) {\n\t\t\t\t\t\t\tthis.$emit('switchControlType');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tonKeyUp(event) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 38: // up\n\t\t\t\tcase 87: // w\n\t\t\t\t\tthis.pointerLock.moveForward = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 37: // left\n\t\t\t\tcase 65: // a\n\t\t\t\t\tthis.pointerLock.moveLeft = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 40: // down\n\t\t\t\tcase 83: // s\n\t\t\t\t\tthis.pointerLock.moveBackward = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 39: // right\n\t\t\t\tcase 68: // d\n\t\t\t\t\tthis.pointerLock.moveRight = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t},\n};\n</script>\n\n<style lang=\"scss\">\n#visualizer {\n\theight: 100vh;\n\twidth: 100vw;\n}\n</style>\n"]}]}